<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>foobar2000 SDK: foobar2000/SDK/filesystem.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">foobar2000 SDK
   &#160;<span id="projectnumber">2015-08-03</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="../../namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="../../annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="../../search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="../../search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="../../files.html"><span>File&#160;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../dir_43ec8d21f415bdd7c2ad739bacdaf524.html">foobar2000</a></li><li class="navelem"><a class="el" href="../../dir_b1f70a8e25c3334e95e43eba668dd904.html">SDK</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">filesystem.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="../../d9/d8f/filesystem_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="../../dd/d82/foobar2000_8h.html">foobar2000.h</a>&quot;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno"><a class="line" href="../../d9/d8f/filesystem_8cpp.html#aaf682e7ffda5d7c843ba2f46fe8270f0">    3</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="../../d9/d8f/filesystem_8cpp.html#aaf682e7ffda5d7c843ba2f46fe8270f0">unpack_prefix</a>[] = <span class="stringliteral">&quot;unpack://&quot;</span>;</div><div class="line"><a name="l00004"></a><span class="lineno"><a class="line" href="../../d9/d8f/filesystem_8cpp.html#a4f34d56bac480070aa52f308ed977e74">    4</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <a class="code" href="../../d9/d8f/filesystem_8cpp.html#a4f34d56bac480070aa52f308ed977e74">unpack_prefix_len</a> = 9;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;</div><div class="line"><a name="l00006"></a><span class="lineno"><a class="line" href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">    6</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">unpacker::g_open</a>(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_out,<span class="keyword">const</span> <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p,<a class="code" href="../../d8/d6a/classabort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;{</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;    <a class="code" href="../../dc/d8f/classservice__enum__t.html">service_enum_t&lt;unpacker&gt;</a> e;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;unpacker&gt;</a> ptr;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;    <span class="keywordflow">if</span> (e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#a8a17594b8c79fff34fa2f950291e64a8">first</a>(ptr)) <span class="keywordflow">do</span> {</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;        p-&gt;reopen(p_abort);</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;        <span class="keywordflow">try</span> {</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;            ptr-&gt;open(p_out,p,p_abort);</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;        } <span class="keywordflow">catch</span>(exception_io_data <span class="keyword">const</span> &amp;) {}</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;    } <span class="keywordflow">while</span>(e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#aa7bc4a60879309afea538110b61a7512">next</a>(ptr));</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    <span class="keywordflow">throw</span> exception_io_data();</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;}</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#ae69b913d93b23593514e62af81b8d673">   20</a></span>&#160;<span class="keywordtype">void</span> file::seek_probe(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_position, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;    <span class="keywordflow">try</span> { <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#a066f24f7277c206a771739ebb4b72944">seek</a>(p_position, p_abort); } <span class="keywordflow">catch</span>(exception_io_seek_out_of_range) {<span class="keywordflow">throw</span> exception_io_data();}</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;}</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a356ce0f11abf3595024c4fc4f95c9406">   24</a></span>&#160;<span class="keywordtype">void</span> file::seek_ex(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#aff65056a9e08a68d3ddbc548b9f8044b">t_sfilesize</a> p_position, <a class="code" href="../../d9/db7/classfoobar2000__io_1_1file.html#a1722ee85dc0dc746b037107276a3d06c">file::t_seek_mode</a> p_mode, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp;p_abort) {</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    <span class="keywordflow">switch</span>(p_mode) {</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordflow">case</span> seek_from_beginning:</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;        <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#a066f24f7277c206a771739ebb4b72944">seek</a>(p_position,p_abort);</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;    <span class="keywordflow">case</span> seek_from_current:</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;        <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#a066f24f7277c206a771739ebb4b72944">seek</a>(p_position + get_position(p_abort),p_abort);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">case</span> seek_from_eof:</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#a066f24f7277c206a771739ebb4b72944">seek</a>(p_position + get_size_ex(p_abort),p_abort);</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="keywordflow">break</span>;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keywordflow">throw</span> exception_io_data();</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    }</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;}</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="../../d9/d8f/filesystem_8cpp.html#ae006d9e1193225b2370859c90f0053c8">   40</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d8f/filesystem_8cpp.html#ae006d9e1193225b2370859c90f0053c8">makeBuffer</a>(<a class="code" href="../../d8/de4/classpfc_1_1array__t.html">pfc::array_t&lt;uint8_t&gt;</a> &amp; buffer, <span class="keywordtype">size_t</span> size) {</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    <span class="keywordflow">for</span>(;;) {<span class="comment">// Tolerant malloc - allocate a smaller buffer if we&#39;re unable to acquire the requested size.</span></div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        <span class="keywordflow">try</span> {</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            buffer.<a class="code" href="../../d8/de4/classpfc_1_1array__t.html#a1d4449e12b37201ba1a93752ab8b8c5e">set_size_discard</a>( size );</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        } <span class="keywordflow">catch</span>(std::bad_alloc) {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            <span class="keywordflow">if</span> (size &lt; 256) <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            size &gt;&gt;= 1;</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;        }</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;}</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> file::g_transfer(<a class="code" href="../../d7/d0c/classstream__reader.html">stream_reader</a> * p_src,<a class="code" href="../../da/dd5/classstream__writer.html">stream_writer</a> * p_dst,<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_bytes,<a class="code" href="../../d8/d6a/classabort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <a class="code" href="../../d8/de4/classpfc_1_1array__t.html">pfc::array_t&lt;t_uint8&gt;</a> temp;</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <a class="code" href="../../d9/d8f/filesystem_8cpp.html#ae006d9e1193225b2370859c90f0053c8">makeBuffer</a>(temp, (<a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a>)pfc::min_t&lt;t_filesize&gt;(1024*1024*8,p_bytes));</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordtype">void</span>* ptr = temp.<a class="code" href="../../d8/de4/classpfc_1_1array__t.html#acaadac76776907d2e4155872b6c609f4">get_ptr</a>();</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> done = 0;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">while</span>(done&lt;p_bytes) {</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        p_abort.check_e();</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> delta = (<a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a>)pfc::min_t&lt;t_filesize&gt;(temp.<a class="code" href="../../d8/de4/classpfc_1_1array__t.html#a0231c35bc24e3610cb6e32bcaad30295">get_size</a>(),p_bytes-done);</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        delta = p_src-&gt;read(ptr,delta,p_abort);</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        <span class="keywordflow">if</span> (delta&lt;=0) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        p_dst-&gt;write(ptr,delta,p_abort);</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        done += delta;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    <span class="keywordflow">return</span> done;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;}</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keywordtype">void</span> file::g_transfer_object(<a class="code" href="../../d7/d0c/classstream__reader.html">stream_reader</a> * p_src,<a class="code" href="../../da/dd5/classstream__writer.html">stream_writer</a> * p_dst,<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_bytes,<a class="code" href="../../d8/d6a/classabort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (g_transfer(p_src,p_dst,p_bytes,p_abort) != p_bytes)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">throw</span> exception_io_data_truncation();</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;}</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;</div><div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a9c0ea965748ef133e269bbaae59a1c27">   74</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_get_canonical_path(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out)</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;{</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    TRACK_CALL_TEXT(<span class="stringliteral">&quot;filesystem::g_get_canonical_path&quot;</span>);</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <a class="code" href="../../dc/d8f/classservice__enum__t.html">service_enum_t&lt;filesystem&gt;</a> e;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> ptr;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="keywordflow">if</span> (e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#a8a17594b8c79fff34fa2f950291e64a8">first</a>(ptr)) <span class="keywordflow">do</span> {</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keywordflow">if</span> (ptr-&gt;get_canonical_path(path,out)) <span class="keywordflow">return</span>;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    } <span class="keywordflow">while</span>(e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#aa7bc4a60879309afea538110b61a7512">next</a>(ptr));</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <span class="comment">//no one wants to process this, let&#39;s copy over</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    out = path;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div><div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a3891a1c81ab618b1a8d20806e16fad20">   87</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_get_display_path(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    TRACK_CALL_TEXT(<span class="stringliteral">&quot;filesystem::g_get_display_path&quot;</span>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> ptr;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">if</span> (!g_get_interface(ptr,path))</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    {</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="comment">//no one wants to process this, let&#39;s copy over</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        out = path;</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    }</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    <span class="keywordflow">else</span></div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        <span class="keywordflow">if</span> (!ptr-&gt;get_display_path(path,out))</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            out = path;</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;}</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div><div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#aa117b6894045059f8fa1c91ead00e479">  103</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_get_native_path( <span class="keyword">const</span> <span class="keywordtype">char</span> * path, <a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out) {</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="comment">// Is proper file:// path?</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#aefb5dfd2df1388ae8c7bd83428e047c0">foobar2000_io::extract_native_path</a>( path, out ) ) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <span class="comment">// Set anyway</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    out = path;</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    </div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="comment">// Maybe just a file:// less local path? Check for other protocol markers</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    <span class="comment">// If no :// present, return true anyway</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <span class="keywordflow">return</span> strstr( path, <span class="stringliteral">&quot;://&quot;</span> ) == NULL;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;}</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a2fe6bc96017106bc560b87efd83b9bf1">  115</a></span>&#160;filesystem::ptr filesystem::g_get_interface(<span class="keyword">const</span> <span class="keywordtype">char</span> * path) {</div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    filesystem::ptr rv;</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    <span class="keywordflow">if</span> (!g_get_interface(rv, path)) <span class="keywordflow">throw</span> exception_io_no_handler_for_path();</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="keywordflow">return</span> rv;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;}</div><div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#adef2f168b2f579e0a5416cf2c77829dc">  121</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_get_interface(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> &amp; p_out,<span class="keyword">const</span> <span class="keywordtype">char</span> * path)</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <a class="code" href="../../dc/d8f/classservice__enum__t.html">service_enum_t&lt;filesystem&gt;</a> e;</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> ptr;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">if</span> (e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#a8a17594b8c79fff34fa2f950291e64a8">first</a>(ptr)) <span class="keywordflow">do</span> {</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">if</span> (ptr-&gt;is_our_path(path))</div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        {</div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            p_out = ptr;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        }</div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    } <span class="keywordflow">while</span>(e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#aa7bc4a60879309afea538110b61a7512">next</a>(ptr));</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;}</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#af7514b1c5bfa7b9c6925c14567d8fd47">  136</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_open(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_out,<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#aa773eda3e691cfe3baaaa71565c59dd2">t_open_mode</a> mode,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;{</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    TRACK_CALL_TEXT(<span class="stringliteral">&quot;filesystem::g_open&quot;</span>);</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    g_get_interface(path)-&gt;open(p_out,path,mode,p_abort);</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div><div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a39ced0dabf78210aebf6ec5d59c2af41">  143</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_open_timeout(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_out,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#aa773eda3e691cfe3baaaa71565c59dd2">t_open_mode</a> p_mode,<span class="keywordtype">double</span> p_timeout,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    FB2K_RETRY_ON_SHARING_VIOLATION( <a class="code" href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">g_open</a>(p_out, p_path, p_mode, p_abort), p_abort, p_timeout);</div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;}</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#ae972c06bf3df5033b6039c705eed4231">  147</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_exists(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;{</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> stats;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="keywordtype">bool</span> dummy;</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        g_get_stats(p_path,stats,dummy,p_abort);</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    } <span class="keywordflow">catch</span>(exception_io_not_found) {<span class="keywordflow">return</span> <span class="keyword">false</span>;}</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a21ae8916ec025962b0fa3b7d77d7af02">  157</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_exists_writeable(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;{</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> stats;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordtype">bool</span> writeable;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        g_get_stats(p_path,stats,writeable,p_abort);</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    } <span class="keywordflow">catch</span>(exception_io_not_found) {<span class="keywordflow">return</span> <span class="keyword">false</span>;}</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">return</span> writeable;</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div><div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a98b84eaeefee3eafa285e3bfc0038a13">  167</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_remove(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    g_get_interface(p_path)-&gt;remove(p_path,p_abort);</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;}</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div><div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a66bd011942fceb716fe17c51dd20d2f6">  171</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_remove_timeout(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<span class="keywordtype">double</span> p_timeout,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    FB2K_RETRY_FILE_MOVE( g_remove(p_path, p_abort), p_abort, p_timeout );</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;}</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#acbe9c28da2879b50e8b163e48f30f33b">  175</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_move_timeout(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_src,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_dst,<span class="keywordtype">double</span> p_timeout,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    FB2K_RETRY_FILE_MOVE( g_move(p_src, p_dst, p_abort), p_abort, p_timeout );</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;}</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#adab2385a2779095ee328234703340002">  179</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_copy_timeout(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_src,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_dst,<span class="keywordtype">double</span> p_timeout,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    FB2K_RETRY_FILE_MOVE( g_copy(p_src, p_dst, p_abort), p_abort, p_timeout );</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;}</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a3e9e7ba51838d76799e7eca29537c6b2">  183</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_create_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;{</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    g_get_interface(p_path)-&gt;create_directory(p_path,p_abort);</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;}</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;</div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#aab6621d896cb0720a0f41b4418fb1713">  188</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_move(<span class="keyword">const</span> <span class="keywordtype">char</span> * src,<span class="keyword">const</span> <span class="keywordtype">char</span> * dst,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <a class="code" href="../../dc/d8f/classservice__enum__t.html">service_enum_t&lt;filesystem&gt;</a> e;</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> ptr;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="keywordflow">if</span> (e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#a8a17594b8c79fff34fa2f950291e64a8">first</a>(ptr)) <span class="keywordflow">do</span> {</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordflow">if</span> (ptr-&gt;is_our_path(src) &amp;&amp; ptr-&gt;is_our_path(dst)) {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            ptr-&gt;move(src,dst,p_abort);</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="keywordflow">return</span>;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        }</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    } <span class="keywordflow">while</span>(e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#aa7bc4a60879309afea538110b61a7512">next</a>(ptr));</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">throw</span> exception_io_no_handler_for_path();</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a3c17dc3181fa5fd6f1b44d0b042d3cfa">  200</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_link(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_src,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_dst,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#acc60e945185aeba1b787e33747ec1e73">foobar2000_io::_extract_native_path_ptr</a>(p_src) || !<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#acc60e945185aeba1b787e33747ec1e73">foobar2000_io::_extract_native_path_ptr</a>(p_dst)) <span class="keywordflow">throw</span> exception_io_no_handler_for_path();</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    WIN32_IO_OP( CreateHardLink( <a class="code" href="../../d9/d66/classpfc_1_1stringcvt_1_1string__wide__from__utf8__t.html">pfc::stringcvt::string_os_from_utf8</a>( p_dst ), <a class="code" href="../../d9/d66/classpfc_1_1stringcvt_1_1string__wide__from__utf8__t.html">pfc::stringcvt::string_os_from_utf8</a>( p_src ), NULL) );</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div><div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#ad1156e2bbb01ff8a83614d6256377fef">  205</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_link_timeout(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_src,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_dst,<span class="keywordtype">double</span> p_timeout,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    FB2K_RETRY_FILE_MOVE( g_link(p_src, p_dst, p_abort), p_abort, p_timeout );</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;}</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#ab03820a1e2fb420f4ade9d189f6f61a8">  210</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_list_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d0/de1/classfoobar2000__io_1_1directory__callback.html">directory_callback</a> &amp; p_out,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;{</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    TRACK_CALL_TEXT(<span class="stringliteral">&quot;filesystem::g_list_directory&quot;</span>);</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    g_get_interface(p_path)-&gt;list_directory(p_path,p_out,p_abort);</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;}</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div><div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="../../d9/d8f/filesystem_8cpp.html#a98bb9acbb9e1b019198fc0b25ae70cd6">  217</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="../../d9/d8f/filesystem_8cpp.html#a98bb9acbb9e1b019198fc0b25ae70cd6">path_pack_string</a>(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out,<span class="keyword">const</span> <span class="keywordtype">char</span> * src)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;{</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    out.<a class="code" href="../../d0/d89/classpfc_1_1string__receiver.html#afb746d606ff9a54ab8fb2d978644ad49">add_char</a>(<span class="charliteral">&#39;|&#39;</span>);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    out &lt;&lt; (unsigned) strlen(src);</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    out.<a class="code" href="../../d0/d89/classpfc_1_1string__receiver.html#afb746d606ff9a54ab8fb2d978644ad49">add_char</a>(<span class="charliteral">&#39;|&#39;</span>);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    out &lt;&lt; src;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    out.<a class="code" href="../../d0/d89/classpfc_1_1string__receiver.html#afb746d606ff9a54ab8fb2d978644ad49">add_char</a>(<span class="charliteral">&#39;|&#39;</span>);</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;</div><div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="../../d9/d8f/filesystem_8cpp.html#afb6ed478f8defbe5a59164a48fafbb32">  226</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="../../d9/d8f/filesystem_8cpp.html#afb6ed478f8defbe5a59164a48fafbb32">path_unpack_string</a>(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out,<span class="keyword">const</span> <span class="keywordtype">char</span> * src)</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;{</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keywordtype">int</span> ptr=0;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keywordflow">if</span> (src[ptr++]!=<span class="charliteral">&#39;|&#39;</span>) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keywordtype">int</span> len = atoi(src+ptr);</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keywordflow">if</span> (len&lt;=0) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keywordflow">while</span>(src[ptr]!=0 &amp;&amp; src[ptr]!=<span class="charliteral">&#39;|&#39;</span>) ptr++;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span> (src[ptr]!=<span class="charliteral">&#39;|&#39;</span>) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    ptr++;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordtype">int</span> start = ptr;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">while</span>(ptr-start&lt;len)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    {</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <span class="keywordflow">if</span> (src[ptr]==0) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        ptr++;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">if</span> (src[ptr]!=<span class="charliteral">&#39;|&#39;</span>) <span class="keywordflow">return</span> -1;</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#af5066868b1828de502dca57545c5ac7e">set_string</a>(&amp;src[start],len);</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    ptr++;  </div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="keywordflow">return</span> ptr;</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;}</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div><div class="line"><a name="l00248"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#ac5da56f04faef745db48df30eb557bb7">  248</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_open_precache(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_out,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> fs = g_get_interface(p_path);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    <span class="keywordflow">if</span> (fs-&gt;is_remote(p_path)) <span class="keywordflow">throw</span> exception_io_object_is_remote();</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    fs-&gt;open(p_out,p_path,open_mode_read,p_abort);</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;}</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;</div><div class="line"><a name="l00254"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a5eb905c0760da19e8355e7cb4bb6c9cb">  254</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_is_remote(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path) {</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <span class="keywordflow">return</span> g_get_interface(p_path)-&gt;is_remote(p_path);</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;}</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div><div class="line"><a name="l00258"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a78f3e4be3b584e6a4cf3e92828f5fea6">  258</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_is_recognized_and_remote(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path) {</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> fs;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">if</span> (g_get_interface(fs,p_path)) <span class="keywordflow">return</span> fs-&gt;is_remote(p_path);</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div><div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a9c737023de92283c3b42f133ba78cf2c">  264</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_is_remote_or_unrecognized(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path) {</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> fs;</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordflow">if</span> (g_get_interface(fs,p_path)) <span class="keywordflow">return</span> fs-&gt;is_remote(p_path);</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;}</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div><div class="line"><a name="l00270"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#ad63252b49d37f1a8565298143297de58">  270</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_relative_path_create(<span class="keyword">const</span> <span class="keywordtype">char</span> * file_path,<span class="keyword">const</span> <span class="keywordtype">char</span> * playlist_path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out)</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;{</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    </div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    <span class="keywordtype">bool</span> rv = <span class="keyword">false</span>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> fs;</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    <span class="keywordflow">if</span> (g_get_interface(fs,file_path))</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        rv = fs-&gt;relative_path_create(file_path,playlist_path,out);</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    </div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="keywordflow">return</span> rv;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;}</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a9bf4db187dca535efe230a98d5763a7a">  282</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_relative_path_parse(<span class="keyword">const</span> <span class="keywordtype">char</span> * relative_path,<span class="keyword">const</span> <span class="keywordtype">char</span> * playlist_path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;{</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <a class="code" href="../../dc/d8f/classservice__enum__t.html">service_enum_t&lt;filesystem&gt;</a> e;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;filesystem&gt;</a> ptr;</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span> (e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#a8a17594b8c79fff34fa2f950291e64a8">first</a>(ptr)) <span class="keywordflow">do</span> {</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="keywordflow">if</span> (ptr-&gt;relative_path_parse(relative_path,playlist_path,out)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    } <span class="keywordflow">while</span>(e.<a class="code" href="../../dc/d8f/classservice__enum__t.html#aa7bc4a60879309afea538110b61a7512">next</a>(ptr));</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;}</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#ab0f85e412e10039503839ef843b476d4">  294</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::get_canonical_path(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out)</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;{</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    <span class="keywordflow">if</span> (is_our_path(path))</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    {</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<a class="code" href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a>,archive_canonical;</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordflow">if</span> (g_parse_unpack_path(path,archive,file))</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        {</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            g_get_canonical_path(archive,archive_canonical);</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            make_unpack_path(out,archive_canonical,file);</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        }</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    }</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;}</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div><div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a07b2b56c58e10f2d7acee47e67718016">  311</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::is_our_path(<span class="keyword">const</span> <span class="keywordtype">char</span> * path)</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;{</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <span class="keywordflow">if</span> (!g_is_unpack_path(path)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> * type = get_archive_type();</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    path += 9;</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">while</span>(*type)</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    {</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">if</span> (*type!=*path) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        type++;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        path++;</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">if</span> (*path!=<span class="charliteral">&#39;|&#39;</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div><div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#ac5acc35cf68b547e620e9baa26ca8ae2">  326</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::get_display_path(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out)</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;{</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<a class="code" href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a>;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordflow">if</span> (g_parse_unpack_path(path,archive,file))</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    {</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        g_get_display_path(archive,out);</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a6a2bc34244698aa39f0c095e137ee316">add_string</a>(<span class="stringliteral">&quot;|&quot;</span>);</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a6a2bc34244698aa39f0c095e137ee316">add_string</a>(file);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    }</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;}</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;</div><div class="line"><a name="l00339"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a9c58dadb4d396575b29f9b3a24b58ecf">  339</a></span>&#160;<span class="keywordtype">void</span> archive_impl::open(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_out,<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#aa773eda3e691cfe3baaaa71565c59dd2">t_open_mode</a> mode, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;{</div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordflow">if</span> (mode != open_mode_read) <span class="keywordflow">throw</span> exception_io_denied();</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<a class="code" href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordflow">if</span> (!g_parse_unpack_path(path,archive,file)) <span class="keywordflow">throw</span> exception_io_not_found();</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    open_archive(p_out,archive,file,p_abort);</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;}</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a620a95f3e5f4accf9db99ee3b6601b41">  348</a></span>&#160;<span class="keywordtype">void</span> archive_impl::remove(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordflow">throw</span> exception_io_denied();</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;}</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div><div class="line"><a name="l00352"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a43ebcfaeb3e4655fa7759bdadc04cba6">  352</a></span>&#160;<span class="keywordtype">void</span> archive_impl::move(<span class="keyword">const</span> <span class="keywordtype">char</span> * src,<span class="keyword">const</span> <span class="keywordtype">char</span> * dst,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    <span class="keywordflow">throw</span> exception_io_denied();</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;}</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div><div class="line"><a name="l00356"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a15d87d913c3cb30c3621b115782ac1f7">  356</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::is_remote(<span class="keyword">const</span> <span class="keywordtype">char</span> * src) {</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;    <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<a class="code" href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a>;</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <span class="keywordflow">if</span> (g_parse_unpack_path(src,archive,file)) <span class="keywordflow">return</span> g_is_remote(archive);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">throw</span> exception_io_not_found();</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;}</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;</div><div class="line"><a name="l00362"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#ad5d234565c1b9c88ed3dbaf412f2b5e8">  362</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::relative_path_create(<span class="keyword">const</span> <span class="keywordtype">char</span> * file_path,<span class="keyword">const</span> <span class="keywordtype">char</span> * playlist_path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out) {</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<a class="code" href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a>;</div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <span class="keywordflow">if</span> (g_parse_unpack_path(file_path,archive,file))</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    {</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> archive_rel;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">if</span> (g_relative_path_create(archive,playlist_path,archive_rel))</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        {</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> out_path;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            make_unpack_path(out_path,archive_rel,file);</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#af5066868b1828de502dca57545c5ac7e">set_string</a>(out_path);</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        }</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    }</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;}</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a8be8cc1becad1903fb89f50c9508b670">  378</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::relative_path_parse(<span class="keyword">const</span> <span class="keywordtype">char</span> * relative_path,<span class="keyword">const</span> <span class="keywordtype">char</span> * playlist_path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out)</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;{</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <span class="keywordflow">if</span> (!is_our_path(relative_path)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> archive_rel,<a class="code" href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a>;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    <span class="keywordflow">if</span> (g_parse_unpack_path(relative_path,archive_rel,file))</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    {</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        <span class="keywordflow">if</span> (g_relative_path_parse(archive_rel,playlist_path,archive))</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        {</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> out_path;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;            make_unpack_path(out_path,archive,file);</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;            out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#af5066868b1828de502dca57545c5ac7e">set_string</a>(out_path);</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        }</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    }</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;}</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#af2e62925df7697b56c95e89189a40086">  396</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::g_parse_unpack_path_ex(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; <a class="code" href="../../d9/db7/classfoobar2000__io_1_1file.html">file</a>, <a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; type) {</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    PFC_ASSERT( g_is_unpack_path(path) );</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> * base = path + <a class="code" href="../../d9/d8f/filesystem_8cpp.html#a4f34d56bac480070aa52f308ed977e74">unpack_prefix_len</a>; <span class="comment">// strstr(path, &quot;//&quot;);</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> * split = strchr(path,<span class="charliteral">&#39;|&#39;</span>);</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">if</span> (base == NULL || split == NULL || base &gt; split) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <span class="comment">// base += 2;</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    type.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#af5066868b1828de502dca57545c5ac7e">set_string</a>( base, split - base );</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordtype">int</span> delta = <a class="code" href="../../d9/d8f/filesystem_8cpp.html#afb6ed478f8defbe5a59164a48fafbb32">path_unpack_string</a>(archive,split);</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">if</span> (delta&lt;0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    split += delta;</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    file = split;</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;}</div><div class="line"><a name="l00409"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a578df4b34e6b7c19c49e27cb0f12ea12">  409</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::g_parse_unpack_path(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; <a class="code" href="../../d9/db7/classfoobar2000__io_1_1file.html">file</a>) {</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    PFC_ASSERT( g_is_unpack_path(path) );</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    path  = strchr(path,<span class="charliteral">&#39;|&#39;</span>);</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span> (!path) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    <span class="keywordtype">int</span> delta = <a class="code" href="../../d9/d8f/filesystem_8cpp.html#afb6ed478f8defbe5a59164a48fafbb32">path_unpack_string</a>(archive,path);</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keywordflow">if</span> (delta&lt;0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    path += delta;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    file = path;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;}</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a84ff1951afb5e4ab5fd38869f8537a1f">  420</a></span>&#160;<span class="keywordtype">bool</span> archive_impl::g_is_unpack_path(<span class="keyword">const</span> <span class="keywordtype">char</span> * path) {</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keywordflow">return</span> strncmp(path,<a class="code" href="../../d9/d8f/filesystem_8cpp.html#aaf682e7ffda5d7c843ba2f46fe8270f0">unpack_prefix</a>,<a class="code" href="../../d9/d8f/filesystem_8cpp.html#a4f34d56bac480070aa52f308ed977e74">unpack_prefix_len</a>) == 0;</div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;}</div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div><div class="line"><a name="l00424"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a5d0451489af391c2182e96a3d5c268d3">  424</a></span>&#160;<span class="keywordtype">void</span> archive_impl::g_make_unpack_path(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; path,<span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="../../d9/db7/classfoobar2000__io_1_1file.html">file</a>,<span class="keyword">const</span> <span class="keywordtype">char</span> * name)</div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;{</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    path = <a class="code" href="../../d9/d8f/filesystem_8cpp.html#aaf682e7ffda5d7c843ba2f46fe8270f0">unpack_prefix</a>;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;    path += name;</div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <a class="code" href="../../d9/d8f/filesystem_8cpp.html#a98bb9acbb9e1b019198fc0b25ae70cd6">path_pack_string</a>(path,archive);</div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    path += <a class="code" href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a>;</div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;}</div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;</div><div class="line"><a name="l00432"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#ad22530bcb800876d0ea284757797d804">  432</a></span>&#160;<span class="keywordtype">void</span> archive_impl::make_unpack_path(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; path,<span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="../../d9/db7/classfoobar2000__io_1_1file.html">file</a>) {g_make_unpack_path(path,archive,file,get_archive_type());}</div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div><div class="line"><a name="l00435"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a1f02b50b679d6bd00205d228b9ed7414">  435</a></span>&#160;FILE * filesystem::streamio_open(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<span class="keyword">const</span> <span class="keywordtype">char</span> * flags)</div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;{</div><div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    FILE * ret = 0;</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> temp;</div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    g_get_canonical_path(path,temp);</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">if</span> (!strncmp(temp,<span class="stringliteral">&quot;file://&quot;</span>,7))</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    {</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        ret = _wfopen(<a class="code" href="../../d9/d66/classpfc_1_1stringcvt_1_1string__wide__from__utf8__t.html">pfc::stringcvt::string_wide_from_utf8</a>(path+7),<a class="code" href="../../d9/d66/classpfc_1_1stringcvt_1_1string__wide__from__utf8__t.html">pfc::stringcvt::string_wide_from_utf8</a>(flags));</div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keywordflow">return</span> ret;</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div><div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;</div><div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keyword">class </span>directory_callback_isempty : <span class="keyword">public</span> <a class="code" href="../../d0/de1/classfoobar2000__io_1_1directory__callback.html">directory_callback</a></div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    {</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordtype">bool</span> m_isempty;</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        directory_callback_isempty() : m_isempty(<span class="keyword">true</span>) {}</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keywordtype">bool</span> on_entry(<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html">filesystem</a> * owner,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort,<span class="keyword">const</span> <span class="keywordtype">char</span> * url,<span class="keywordtype">bool</span> is_subdirectory,<span class="keyword">const</span> <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> &amp; p_stats)</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        {</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;            m_isempty = <span class="keyword">false</span>;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        }</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        <span class="keywordtype">bool</span> isempty() {<span class="keywordflow">return</span> m_isempty;}</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    };</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <span class="keyword">class </span>directory_callback_dummy : <span class="keyword">public</span> <a class="code" href="../../d0/de1/classfoobar2000__io_1_1directory__callback.html">directory_callback</a></div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    {</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        <span class="keywordtype">bool</span> on_entry(<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html">filesystem</a> * owner,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort,<span class="keyword">const</span> <span class="keywordtype">char</span> * url,<span class="keywordtype">bool</span> is_subdirectory,<span class="keyword">const</span> <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> &amp; p_stats) {<span class="keywordflow">return</span> <span class="keyword">false</span>;}</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    };</div><div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;}</div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;</div><div class="line"><a name="l00471"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a9028ab86a1000b804e9f11c008cb8b44">  471</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_is_empty_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;{</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    directory_callback_isempty callback;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        g_list_directory(path,callback,p_abort);</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    } <span class="keywordflow">catch</span>(exception_io <span class="keyword">const</span> &amp;) {<span class="keywordflow">return</span> <span class="keyword">false</span>;}</div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span> callback.isempty();</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;}</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;</div><div class="line"><a name="l00480"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a47893fb397af6f0ef22c1dbfcb7b46d3">  480</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_is_valid_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        directory_callback_dummy cb;</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        g_list_directory(path,cb,p_abort);</div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    } <span class="keywordflow">catch</span>(exception_io <span class="keyword">const</span> &amp;) {<span class="keywordflow">return</span> <span class="keyword">false</span>;}</div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;}</div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno"><a class="line" href="../../d1/d7f/classfoobar2000__io_1_1directory__callback__impl.html#afeaf62da96b2ec46f021e17f042ba0da">  488</a></span>&#160;<span class="keywordtype">bool</span> directory_callback_impl::on_entry(<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html">filesystem</a> * owner,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort,<span class="keyword">const</span> <span class="keywordtype">char</span> * url,<span class="keywordtype">bool</span> is_subdirectory,<span class="keyword">const</span> <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> &amp; p_stats) {</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    p_abort.<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html#a08c5b76b05e08bd6535b42e1eb8e420b">check_e</a>();</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordflow">if</span> (is_subdirectory) {</div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;        <span class="keywordflow">if</span> (m_recur) {</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            <span class="keywordflow">try</span> {</div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                owner-&gt;<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a8acba8dc32127e465c24459bc54ea0bf">list_directory</a>(url,*<span class="keyword">this</span>,p_abort);</div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;            } <span class="keywordflow">catch</span>(exception_io <span class="keyword">const</span> &amp;) {}</div><div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        }</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        m_data.add_item(pfc::rcnew_t&lt;t_entry&gt;(url,p_stats));</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;}</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keyword">class </span>directory_callback_impl_copy : <span class="keyword">public</span> <a class="code" href="../../d0/de1/classfoobar2000__io_1_1directory__callback.html">directory_callback</a></div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    {</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        directory_callback_impl_copy(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_target, filesystem::ptr fs) : m_fs(fs)</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        {</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            m_target = p_target;</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            m_target.fix_dir_separator(<span class="charliteral">&#39;\\&#39;</span>);</div><div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        }</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;</div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordtype">bool</span> on_entry(<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html">filesystem</a> * owner,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort,<span class="keyword">const</span> <span class="keywordtype">char</span> * url,<span class="keywordtype">bool</span> is_subdirectory,<span class="keyword">const</span> <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> &amp; p_stats) {</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span> * fn = url + <a class="code" href="../../da/d46/namespacepfc.html#afe4f860f8c74038d00eb4f46e1f3753d">pfc::scan_filename</a>(url);</div><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;            <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> truncat = m_target.length();</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            m_target += fn;</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;            <span class="keywordflow">if</span> (is_subdirectory) {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                <span class="keywordflow">try</span> {</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;                    m_fs-&gt;create_directory(m_target,p_abort);</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;                } <span class="keywordflow">catch</span>(exception_io_already_exists) {}</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;                m_target += <span class="stringliteral">&quot;\\&quot;</span>;</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;                owner-&gt;<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a8acba8dc32127e465c24459bc54ea0bf">list_directory</a>(url,*<span class="keyword">this</span>,p_abort);</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                _copy(url, m_target, owner, p_abort);</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            }</div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            m_target.truncate(truncat);</div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        }</div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="keywordtype">void</span> _copy(<span class="keyword">const</span> <span class="keywordtype">char</span> * src, <span class="keyword">const</span> <span class="keywordtype">char</span> * dst, <a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html">filesystem</a> * srcFS, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> r_src,r_dst;</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> size;</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            srcFS-&gt;<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#acbcbea8b03511fcfd8966c03da108050">open</a>(r_src,src,filesystem::open_mode_read,p_abort);</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            size = r_src-&gt;get_size_ex(p_abort);</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            m_fs-&gt;open(r_dst,dst,filesystem::open_mode_write_new,p_abort);</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    </div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="keywordflow">try</span> {</div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    file::g_transfer_object(r_src,r_dst,size,p_abort);</div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                } <span class="keywordflow">catch</span>(...) {</div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                    r_dst.<a class="code" href="../../d4/d8a/classservice__ptr__t.html#af5f325feac35d1d9f979f2ea71278190">release</a>();</div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                    <a class="code" href="../../d4/d68/classfoobar2000__io_1_1abort__callback__dummy.html">abort_callback_dummy</a> dummy;</div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                    <span class="keywordflow">try</span> {m_fs-&gt;remove(dst,dummy);} <span class="keywordflow">catch</span>(...) {}</div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                    <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                }</div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            }</div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        }</div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keyword">private</span>:</div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;        <a class="code" href="../../da/d46/namespacepfc.html#a1832fb4e2e570eb33039ca084be3154d">pfc::string8_fastalloc</a> m_target;</div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;        filesystem::ptr m_fs;</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    };</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;}</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00553"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a8e44e74a1f9735fec21a263089f1f1dd">  553</a></span>&#160;<span class="keywordtype">void</span> filesystem::copy_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> * src, <span class="keyword">const</span> <span class="keywordtype">char</span> * dst, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        this-&gt;create_directory( dst, p_abort );</div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    } <span class="keywordflow">catch</span>(exception_io_already_exists) {}</div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    directory_callback_impl_copy cb(dst, <span class="keyword">this</span>);</div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    list_directory(src, cb, p_abort);</div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;}</div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;</div><div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a36bee09243455c09de28b33b8d1cc32e">  561</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_copy_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> * src,<span class="keyword">const</span> <span class="keywordtype">char</span> * dst,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    filesystem::ptr dstFS = filesystem::g_get_interface(dst);</div><div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        dstFS-&gt;create_directory( dst, p_abort );</div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    } <span class="keywordflow">catch</span>(exception_io_already_exists) {}</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    directory_callback_impl_copy cb(dst, dstFS);</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    g_list_directory(src,cb,p_abort);</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;}</div><div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;</div><div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a6befc135c9cbd2f7575d990bace778ad">  570</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_copy(<span class="keyword">const</span> <span class="keywordtype">char</span> * src,<span class="keyword">const</span> <span class="keywordtype">char</span> * dst,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> r_src,r_dst;</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> size;</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <a class="code" href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">g_open</a>(r_src,src,open_mode_read,p_abort);</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    size = r_src-&gt;get_size_ex(p_abort);</div><div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    <a class="code" href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">g_open</a>(r_dst,dst,open_mode_write_new,p_abort);</div><div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    </div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="keywordflow">if</span> (size &gt; 0) {</div><div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">try</span> {</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            file::g_transfer_object(r_src,r_dst,size,p_abort);</div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        } <span class="keywordflow">catch</span>(...) {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            r_dst.<a class="code" href="../../d4/d8a/classservice__ptr__t.html#af5f325feac35d1d9f979f2ea71278190">release</a>();</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <a class="code" href="../../d4/d68/classfoobar2000__io_1_1abort__callback__dummy.html">abort_callback_dummy</a> dummy;</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">try</span> {g_remove(dst,dummy);} <span class="keywordflow">catch</span>(...) {}</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            <span class="keywordflow">throw</span>;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        }</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    }</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;}</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;</div><div class="line"><a name="l00590"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#a3932aec7aa54a2e6342db9692a33f414">  590</a></span>&#160;<span class="keywordtype">void</span> stream_reader::read_object(<span class="keywordtype">void</span> * p_buffer,<a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> p_bytes,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../d3/d80/namespacetext__file__loader.html#a523f7796376195399b3791763806fc27">read</a>(p_buffer,p_bytes,p_abort) != p_bytes) <span class="keywordflow">throw</span> exception_io_data_truncation();</div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;}</div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div><div class="line"><a name="l00594"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a791ad7732a5efb122b0d0e1f3e11fbca">  594</a></span>&#160;<a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> file::get_stats(<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;{</div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> temp;</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    temp.<a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html#a3f420232c448e40510d4abe78152c9ee">m_size</a> = <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#aa6b03adbff3485bf5f5151178fa67bd7">get_size</a>(p_abort);</div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    temp.<a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html#af0883e72d1faa0818d0850c05b1c5b8e">m_timestamp</a> = get_timestamp(p_abort);</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordflow">return</span> temp;</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;}</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;</div><div class="line"><a name="l00602"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#ac2e6c88a34ef891bf5116fdfbd910e56">  602</a></span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> stream_reader::skip(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_bytes,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;{</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <a class="code" href="../../d1/d8c/int__types_8h.html#a6db43f58b64d133266c806191b05213f">t_uint8</a> temp[256];</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> todo = p_bytes, done = 0;</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;    <span class="keywordflow">while</span>(todo &gt; 0) {</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> delta,deltadone;</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        delta = <span class="keyword">sizeof</span>(temp);</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;        <span class="keywordflow">if</span> (delta &gt; todo) delta = (<a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a>) todo;</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        deltadone = <a class="code" href="../../d3/d80/namespacetext__file__loader.html#a523f7796376195399b3791763806fc27">read</a>(temp,delta,p_abort);</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        done += deltadone;</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        todo -= deltadone;</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keywordflow">if</span> (deltadone &lt; delta) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    }</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordflow">return</span> done;</div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;}</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;</div><div class="line"><a name="l00618"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#a2cc2ae2681c7a22e723b43ffa9a00ae0">  618</a></span>&#160;<span class="keywordtype">void</span> stream_reader::skip_object(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_bytes,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;    <span class="keywordflow">if</span> (skip(p_bytes,p_abort) != p_bytes) <span class="keywordflow">throw</span> exception_io_data_truncation();</div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;}</div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;</div><div class="line"><a name="l00622"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a93ec5364246b80140c133408a305f85a">  622</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_open_write_new(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_out,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;    <a class="code" href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">g_open</a>(p_out,p_path,open_mode_write_new,p_abort);</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;}</div><div class="line"><a name="l00625"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a3ed27969696177a076716d3102d24f1a">  625</a></span>&#160;<span class="keywordtype">void</span> file::g_transfer_file(<span class="keyword">const</span> <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_from,<span class="keyword">const</span> <a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_to,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> length = p_from-&gt;get_size(p_abort);</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    p_from-&gt;reopen( p_abort );</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">//  p_from-&gt;seek(0,p_abort);</span></div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    p_to-&gt;seek(0,p_abort);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    p_to-&gt;set_eof(p_abort);</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    <span class="keywordflow">if</span> (length == <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a8248180a5cfbcbc960de25522713db39">filesize_invalid</a>) {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;        g_transfer(p_from, p_to, ~0, p_abort);</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length &gt; 0) {</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;        g_transfer_object(p_from,p_to,length,p_abort);</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    }</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;}</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00638"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#acac83fa44dda1fe1ebf2d912933b59c5">  638</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_open_temp(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_out,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <a class="code" href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">g_open</a>(p_out,<span class="stringliteral">&quot;tempfile://&quot;</span>,open_mode_write_new,p_abort);</div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;}</div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div><div class="line"><a name="l00642"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a3dd47911a688342c4efcc4fd5a0e777b">  642</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_open_tempmem(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> &amp; p_out,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <a class="code" href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">g_open</a>(p_out,<span class="stringliteral">&quot;tempmem://&quot;</span>,open_mode_write_new,p_abort);</div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;}</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div><div class="line"><a name="l00646"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a339ac7b191907c8bd4a8f88f50f00df9">  646</a></span>&#160;file::ptr filesystem::g_open_tempmem() {</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <a class="code" href="../../d4/d68/classfoobar2000__io_1_1abort__callback__dummy.html">abort_callback_dummy</a> aborter;</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    file::ptr f; g_open_tempmem(f, aborter); <span class="keywordflow">return</span> f;</div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;}</div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a9603bea6ed2440d46be953a1e16f4ff7">  651</a></span>&#160;<span class="keywordtype">void</span> archive_impl::list_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d0/de1/classfoobar2000__io_1_1directory__callback.html">directory_callback</a> &amp; p_out,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordflow">throw</span> exception_io_not_found();</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;}</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div><div class="line"><a name="l00655"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#a7b5dda40db917baefc6c83f4cbac7780">  655</a></span>&#160;<span class="keywordtype">void</span> archive_impl::create_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> * path,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp;) {</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">throw</span> exception_io_denied();</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;}</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a5a6568f95f589698ac6201e140cd22de">  659</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_get_stats(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> &amp; p_stats,<span class="keywordtype">bool</span> &amp; p_is_writeable,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    TRACK_CALL_TEXT(<span class="stringliteral">&quot;filesystem::g_get_stats&quot;</span>);</div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <span class="keywordflow">return</span> g_get_interface(p_path)-&gt;get_stats(p_path,p_stats,p_is_writeable,p_abort);</div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;}</div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;</div><div class="line"><a name="l00664"></a><span class="lineno"><a class="line" href="../../d3/d85/classfoobar2000__io_1_1archive__impl.html#ac6d49416a3ffea1e122996aacda59271">  664</a></span>&#160;<span class="keywordtype">void</span> archive_impl::get_stats(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path,<a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> &amp; p_stats,<span class="keywordtype">bool</span> &amp; p_is_writeable,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> <a class="code" href="../../d7/d4f/classfoobar2000__io_1_1archive.html">archive</a>,<a class="code" href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a>;</div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">if</span> (g_parse_unpack_path(p_path,archive,file)) {</div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">if</span> (g_is_remote(archive)) <span class="keywordflow">throw</span> exception_io_object_is_remote();</div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        p_is_writeable = <span class="keyword">false</span>;</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        p_stats = get_stats_in_archive(archive,file,p_abort);</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    }</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">throw</span> exception_io_not_found();</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;}</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a4838137cb0e1fe2741b0c8e0ab08103e">  675</a></span>&#160;<span class="keywordtype">bool</span> file::is_eof(<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> position,size;</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    position = get_position(p_abort);</div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    size = <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#aa6b03adbff3485bf5f5151178fa67bd7">get_size</a>(p_abort);</div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">if</span> (size == <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a8248180a5cfbcbc960de25522713db39">filesize_invalid</a>) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    <span class="keywordflow">return</span> position &gt;= size;</div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;}</div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#a7b3ab40fe689238e0503daa11b717d01">  684</a></span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#ac457a97cb865489e01ae724f1ca5f2d6">t_filetimestamp</a> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a7b3ab40fe689238e0503daa11b717d01">foobar2000_io::filetimestamp_from_system_timer</a>()</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;{</div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../da/d46/namespacepfc.html#a58b2a5281932d39848679464328efdc5">pfc::fileTimeNow</a>();</div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;}</div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div><div class="line"><a name="l00689"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#a50c1f77d718cea02f8637c8509d4be24">  689</a></span>&#160;<span class="keywordtype">void</span> stream_reader::read_string_ex(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; p_out,<a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> p_bytes,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> expBase = 64*1024;</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordflow">if</span> (p_bytes &gt; expBase) {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        <a class="code" href="../../d8/de4/classpfc_1_1array__t.html">pfc::array_t&lt;char&gt;</a> temp;</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> allocWalk = expBase;</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> done = 0;</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> target = <a class="code" href="../../da/d46/namespacepfc.html#a6aee231a8e69ac6b24bcc53d9a6e077a">pfc::min_t</a>(allocWalk, p_bytes);</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            temp.<a class="code" href="../../d8/de4/classpfc_1_1array__t.html#a7c13354feeefc4a46ea47df17bd8115f">set_size</a>(target);</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            read_object(temp.<a class="code" href="../../d8/de4/classpfc_1_1array__t.html#acaadac76776907d2e4155872b6c609f4">get_ptr</a>() + done, target - done, p_abort);</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="keywordflow">if</span> (target == p_bytes) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            done = target;</div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            allocWalk &lt;&lt;= 1;</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        }</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        p_out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#af5066868b1828de502dca57545c5ac7e">set_string</a>(temp.<a class="code" href="../../d8/de4/classpfc_1_1array__t.html#acaadac76776907d2e4155872b6c609f4">get_ptr</a>(), p_bytes);</div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <a class="code" href="../../dc/d22/classpfc_1_1string__buffer.html">pfc::string_buffer</a> buf(p_out, p_bytes);</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;        read_object(buf.<a class="code" href="../../dc/d22/classpfc_1_1string__buffer.html#a9c7fdc50ff1c9f3c1940bce45dee29b5">get_ptr</a>(),p_bytes,p_abort);</div><div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;    }</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;}</div><div class="line"><a name="l00709"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#a46708b3230508f9310cf9c0b3536ec4a">  709</a></span>&#160;<span class="keywordtype">void</span> stream_reader::read_string(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; p_out,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort)</div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;{</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <a class="code" href="../../d1/d8c/int__types_8h.html#ae3414e477e7bba6c40aac28eb0b5299c">t_uint32</a> length;</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    read_lendian_t(length,p_abort);</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    read_string_ex(p_out,length,p_abort);</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;}</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;</div><div class="line"><a name="l00716"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#abfc213009763f48746183ad3d84355f8">  716</a></span>&#160;<span class="keywordtype">void</span> stream_reader::read_string_raw(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; p_out,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keyword">enum</span> {delta = 256};</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordtype">char</span> buffer[delta];</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    p_out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a377fd52e6bc50d1a561cbf5bb1aa6e83">reset</a>();</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> delta_done;</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        delta_done = <a class="code" href="../../d3/d80/namespacetext__file__loader.html#a523f7796376195399b3791763806fc27">read</a>(buffer,delta,p_abort);</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        p_out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a6a2bc34244698aa39f0c095e137ee316">add_string</a>(buffer,delta_done);</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        <span class="keywordflow">if</span> (delta_done &lt; delta) <span class="keywordflow">break</span>;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    }</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;}</div><div class="line"><a name="l00727"></a><span class="lineno"><a class="line" href="../../d4/d32/classfoobar2000__io_1_1stream__writer.html#a6638a25f656c80cd33f22617eda968ee">  727</a></span>&#160;<span class="keywordtype">void</span> stream_writer::write_string(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_string,<a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> p_len,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <a class="code" href="../../d1/d8c/int__types_8h.html#ae3414e477e7bba6c40aac28eb0b5299c">t_uint32</a> len = pfc::downcast_guarded&lt;t_uint32&gt;(<a class="code" href="../../da/d46/namespacepfc.html#aac5f485225d85be60883ad9a22415a38">pfc::strlen_max</a>(p_string,p_len));</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    write_lendian_t(len,p_abort);</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    write_object(p_string,len,p_abort);</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;}</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;</div><div class="line"><a name="l00733"></a><span class="lineno"><a class="line" href="../../d4/d32/classfoobar2000__io_1_1stream__writer.html#a222addf9634f8acb364e94683c480aed">  733</a></span>&#160;<span class="keywordtype">void</span> stream_writer::write_string(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_string,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    write_string(p_string,~0,p_abort);</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;}</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;</div><div class="line"><a name="l00737"></a><span class="lineno"><a class="line" href="../../d4/d32/classfoobar2000__io_1_1stream__writer.html#a19d68a1a346ae94ebdeff54d72321561">  737</a></span>&#160;<span class="keywordtype">void</span> stream_writer::write_string_raw(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_string,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    write_object(p_string,strlen(p_string),p_abort);</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;}</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;</div><div class="line"><a name="l00741"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a99a1991ac208759e8abfddeb7f426d7a">  741</a></span>&#160;<span class="keywordtype">void</span> file::truncate(<a class="code" href="../../d1/d8c/int__types_8h.html#a9812fdc2df24f2c0a0db1b461b68a227">t_uint64</a> p_position,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;    <span class="keywordflow">if</span> (p_position &lt; <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#aa6b03adbff3485bf5f5151178fa67bd7">get_size</a>(p_abort)) resize(p_position,p_abort);</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;}</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="preprocessor">#ifdef _WIN32</span></div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="keyword">namespace </span>{</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="comment">//rare/weird win32 errors that didn&#39;t make it to the main API</span></div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <a class="code" href="../../dd/d06/namespacecue__parser.html#af85dc495fbaefec33124ed01c4c7541f">PFC_DECLARE_EXCEPTION</a>(exception_io_device_not_ready,        exception_io,<span class="stringliteral">&quot;Device not ready&quot;</span>);</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <a class="code" href="../../dd/d06/namespacecue__parser.html#af85dc495fbaefec33124ed01c4c7541f">PFC_DECLARE_EXCEPTION</a>(exception_io_invalid_drive,           exception_io_not_found,<span class="stringliteral">&quot;Drive not found&quot;</span>);</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    <a class="code" href="../../dd/d06/namespacecue__parser.html#af85dc495fbaefec33124ed01c4c7541f">PFC_DECLARE_EXCEPTION</a>(exception_io_win32,                   exception_io,<span class="stringliteral">&quot;Generic win32 I/O error&quot;</span>);</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <a class="code" href="../../dd/d06/namespacecue__parser.html#af85dc495fbaefec33124ed01c4c7541f">PFC_DECLARE_EXCEPTION</a>(exception_io_buffer_overflow,         exception_io,<span class="stringliteral">&quot;The file name is too long&quot;</span>);</div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;    <a class="code" href="../../dd/d06/namespacecue__parser.html#af85dc495fbaefec33124ed01c4c7541f">PFC_DECLARE_EXCEPTION</a>(exception_io_invalid_path_syntax,     exception_io,<span class="stringliteral">&quot;Invalid path syntax&quot;</span>);</div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    <span class="keyword">class </span>exception_io_win32_ex : <span class="keyword">public</span> exception_io_win32 {</div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        exception_io_win32_ex(DWORD p_code) : m_msg(<a class="code" href="../../da/d46/namespacepfc.html#a59e4f7c779c41a94f3015c7f7b97bf95">pfc::string_formatter</a>() &lt;&lt; <span class="stringliteral">&quot;I/O error (win32 #&quot;</span> &lt;&lt; (<a class="code" href="../../d1/d8c/int__types_8h.html#ae3414e477e7bba6c40aac28eb0b5299c">t_uint32</a>)p_code &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>) {}</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;        exception_io_win32_ex(<span class="keyword">const</span> exception_io_win32_ex &amp; p_other) {*<span class="keyword">this</span> = p_other;}</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span> * what() <span class="keyword">const</span> <span class="keywordflow">throw</span>() {<span class="keywordflow">return</span> m_msg;}</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keyword">private</span>:</div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <a class="code" href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8</a> m_msg;</div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;    };</div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;</div><div class="line"><a name="l00765"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#af1a295298679aa0cddade9094259b2c9">  765</a></span>&#160;PFC_NORETURN <span class="keywordtype">void</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#af1a295298679aa0cddade9094259b2c9">foobar2000_io::win32_file_write_failure</a>(DWORD p_code, <span class="keyword">const</span> <span class="keywordtype">char</span> * path) {</div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;    <span class="keywordflow">if</span> (p_code == ERROR_ACCESS_DENIED) {</div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;        <span class="keyword">const</span> DWORD attr = <a class="code" href="../../da/db4/shared_8h.html#a0c6fdbba169ad0b55f6bd3165f1a317a">uGetFileAttributes</a>(path);</div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        <span class="keywordflow">if</span> (attr != ~0 &amp;&amp; (attr &amp; FILE_ATTRIBUTE_READONLY) != 0) <span class="keywordflow">throw</span> exception_io_denied_readonly();</div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;    }</div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#ad1c9e41d00e6bc68e826b2120cc2b636">exception_io_from_win32</a>(p_code);</div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;}</div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;</div><div class="line"><a name="l00773"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#ad1c9e41d00e6bc68e826b2120cc2b636">  773</a></span>&#160;PFC_NORETURN <span class="keywordtype">void</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#ad1c9e41d00e6bc68e826b2120cc2b636">foobar2000_io::exception_io_from_win32</a>(DWORD p_code) {</div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">//pfc::string_fixed_t&lt;32&gt; debugMsg; debugMsg &lt;&lt; &quot;Win32 I/O error #&quot; &lt;&lt; (t_uint32)p_code;</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="comment">//TRACK_CALL_TEXT(debugMsg);</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordflow">switch</span>(p_code) {</div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">case</span> ERROR_ALREADY_EXISTS:</div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">case</span> ERROR_FILE_EXISTS:</div><div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        <span class="keywordflow">throw</span> exception_io_already_exists();</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keywordflow">case</span> ERROR_NETWORK_ACCESS_DENIED:</div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="keywordflow">case</span> ERROR_ACCESS_DENIED:</div><div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;        <span class="keywordflow">throw</span> exception_io_denied();</div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">case</span> ERROR_WRITE_PROTECT:</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">throw</span> exception_io_write_protected();</div><div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    <span class="keywordflow">case</span> ERROR_BUSY:</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keywordflow">case</span> ERROR_PATH_BUSY:</div><div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">case</span> ERROR_SHARING_VIOLATION:</div><div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">case</span> ERROR_LOCK_VIOLATION:</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">throw</span> exception_io_sharing_violation();</div><div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    <span class="keywordflow">case</span> ERROR_HANDLE_DISK_FULL:</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    <span class="keywordflow">case</span> ERROR_DISK_FULL:</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;        <span class="keywordflow">throw</span> exception_io_device_full();</div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    <span class="keywordflow">case</span> ERROR_FILE_NOT_FOUND:</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    <span class="keywordflow">case</span> ERROR_PATH_NOT_FOUND:</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <span class="keywordflow">throw</span> exception_io_not_found();</div><div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    <span class="keywordflow">case</span> ERROR_BROKEN_PIPE:</div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="keywordflow">case</span> ERROR_NO_DATA:</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        <span class="keywordflow">throw</span> exception_io_no_data();</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">case</span> ERROR_NETWORK_UNREACHABLE:</div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;    <span class="keywordflow">case</span> ERROR_NETNAME_DELETED:</div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">throw</span> exception_io_network_not_reachable();</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;    <span class="keywordflow">case</span> ERROR_NOT_READY:</div><div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">throw</span> exception_io_device_not_ready();</div><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;    <span class="keywordflow">case</span> ERROR_INVALID_DRIVE:</div><div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        <span class="keywordflow">throw</span> exception_io_invalid_drive();</div><div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">case</span> ERROR_CRC:</div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">case</span> ERROR_FILE_CORRUPT:</div><div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;    <span class="keywordflow">case</span> ERROR_DISK_CORRUPT:</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">throw</span> exception_io_file_corrupted();</div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">case</span> ERROR_BUFFER_OVERFLOW:</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="keywordflow">throw</span> exception_io_buffer_overflow();</div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    <span class="keywordflow">case</span> ERROR_DISK_CHANGE:</div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="keywordflow">throw</span> exception_io_disk_change();</div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;    <span class="keywordflow">case</span> ERROR_DIR_NOT_EMPTY:</div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">throw</span> exception_io_directory_not_empty();</div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">case</span> ERROR_INVALID_NAME:</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <span class="keywordflow">throw</span> exception_io_invalid_path_syntax();</div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">case</span> ERROR_NO_SYSTEM_RESOURCES:</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">case</span> ERROR_NONPAGED_SYSTEM_RESOURCES:</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">case</span> ERROR_PAGED_SYSTEM_RESOURCES:</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keywordflow">case</span> ERROR_WORKING_SET_QUOTA:</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <span class="keywordflow">case</span> ERROR_PAGEFILE_QUOTA:</div><div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    <span class="keywordflow">case</span> ERROR_COMMITMENT_LIMIT:</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <span class="keywordflow">throw</span> exception_io(<span class="stringliteral">&quot;Insufficient system resources&quot;</span>);</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">case</span> ERROR_IO_DEVICE:</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="keywordflow">throw</span> exception_io(<span class="stringliteral">&quot;Device error&quot;</span>);</div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;    <span class="keywordflow">default</span>:</div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="keywordflow">throw</span> exception_io_win32_ex(p_code);</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    }</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;}</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;<span class="preprocessor">#endif</span></div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;</div><div class="line"><a name="l00833"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a56ff277df78f807f80dbc4822836642b">  833</a></span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> file::get_size_ex(<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> temp = <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#aa6b03adbff3485bf5f5151178fa67bd7">get_size</a>(p_abort);</div><div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="keywordflow">if</span> (temp == <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a8248180a5cfbcbc960de25522713db39">filesize_invalid</a>) <span class="keywordflow">throw</span> exception_io_no_length();</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="keywordflow">return</span> temp;</div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;</div><div class="line"><a name="l00839"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a67c910513f7ad965053a9cb3e3b2ac64">  839</a></span>&#160;<span class="keywordtype">void</span> file::ensure_local() {</div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">if</span> (is_remote()) <span class="keywordflow">throw</span> exception_io_object_is_remote();</div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;}</div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;</div><div class="line"><a name="l00843"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#ae7b9f13e1e2f24f2dd677ac89b17f425">  843</a></span>&#160;<span class="keywordtype">void</span> file::ensure_seekable() {</div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    <span class="keywordflow">if</span> (!can_seek()) <span class="keywordflow">throw</span> exception_io_object_not_seekable();</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;}</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div><div class="line"><a name="l00847"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a4013c17ac7543670983dccf426e28df5">  847</a></span>&#160;<span class="keywordtype">bool</span> filesystem::g_is_recognized_path(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_path) {</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    filesystem::ptr obj;</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">return</span> g_get_interface(obj,p_path);</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;}</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;</div><div class="line"><a name="l00852"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a58514e92c00e8884be337f39ca4d33df">  852</a></span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> file::get_remaining(<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> length = get_size_ex(p_abort);</div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> position = get_position(p_abort);</div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    <a class="code" href="../../da/d46/namespacepfc.html#a12079b17838e02b827dc3ff3e31911ff">pfc::dynamic_assert</a>(position &lt;= length);</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <span class="keywordflow">return</span> length - position;</div><div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;}</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;</div><div class="line"><a name="l00859"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#ac6aba41861653260c6630d4dfa9ef57a">  859</a></span>&#160;<span class="keywordtype">void</span> file::probe_remaining(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> bytes, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> length = <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#aa6b03adbff3485bf5f5151178fa67bd7">get_size</a>(p_abort);</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;    <span class="keywordflow">if</span> (length != ~0) {</div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> remaining = length - get_position(p_abort);</div><div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        <span class="keywordflow">if</span> (remaining &lt; bytes) <span class="keywordflow">throw</span> exception_io_data_truncation();</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    }</div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;}</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;</div><div class="line"><a name="l00868"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#ade086d4a50ab5504afb8731b88d8a1ee">  868</a></span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> file::g_transfer(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> p_src,<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> p_dst,<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_bytes,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">return</span> g_transfer(pfc::implicit_cast&lt;stream_reader*&gt;(p_src.<a class="code" href="../../d4/d8a/classservice__ptr__t.html#a461bb62075ae233d6c2e538f77b803d2">get_ptr</a>()),pfc::implicit_cast&lt;stream_writer*&gt;(p_dst.<a class="code" href="../../d4/d8a/classservice__ptr__t.html#a461bb62075ae233d6c2e538f77b803d2">get_ptr</a>()),p_bytes,p_abort);</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;}</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;</div><div class="line"><a name="l00872"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a9d9d627be70df9a73488e9246a8734df">  872</a></span>&#160;<span class="keywordtype">void</span> file::g_transfer_object(<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> p_src,<a class="code" href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt;file&gt;</a> p_dst,<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_bytes,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">if</span> (p_bytes &gt; 1024) <span class="comment">/* don&#39;t bother on small objects */</span> </div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    {</div><div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> srcFileSize = p_src-&gt;get_size(p_abort); <span class="comment">// detect truncation</span></div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="keywordflow">if</span> (srcFileSize != ~0) {</div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> remaining = srcFileSize - p_src-&gt;get_position(p_abort);</div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;            <span class="keywordflow">if</span> (p_bytes &gt; remaining) <span class="keywordflow">throw</span> exception_io_data_truncation();</div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        }</div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;</div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> oldsize = p_dst-&gt;get_size(p_abort); <span class="comment">// pre-resize the target file</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keywordflow">if</span> (oldsize != <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a8248180a5cfbcbc960de25522713db39">filesize_invalid</a>) {</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> newpos = p_dst-&gt;get_position(p_abort) + p_bytes;</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            <span class="keywordflow">if</span> (newpos &gt; oldsize) p_dst-&gt;resize(newpos ,p_abort);</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        }</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;</div><div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    }</div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;    g_transfer_object(pfc::implicit_cast&lt;stream_reader*&gt;(p_src.<a class="code" href="../../d4/d8a/classservice__ptr__t.html#a461bb62075ae233d6c2e538f77b803d2">get_ptr</a>()),pfc::implicit_cast&lt;stream_writer*&gt;(p_dst.<a class="code" href="../../d4/d8a/classservice__ptr__t.html#a461bb62075ae233d6c2e538f77b803d2">get_ptr</a>()),p_bytes,p_abort);</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;}</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;</div><div class="line"><a name="l00892"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#afb56af03bc9888fc80803cf42078654b">  892</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#afb56af03bc9888fc80803cf42078654b">foobar2000_io::generate_temp_location_for_file</a>(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; p_out, <span class="keyword">const</span> <span class="keywordtype">char</span> * p_origpath,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_extension,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_magic) {</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    <a class="code" href="../../da/dfb/structhasher__md5__result.html">hasher_md5_result</a> hash;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    {</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;        <a class="code" href="../../d2/da4/classstatic__api__ptr__t.html">static_api_ptr_t&lt;hasher_md5&gt;</a> hasher;</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;        <a class="code" href="../../d2/db4/hasher__md5_8h.html#d5/d6f/structhasher__md5__state">hasher_md5_state</a> state;</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;        hasher-&gt;initialize(state);</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;        hasher-&gt;process(state,p_origpath,strlen(p_origpath));</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        hasher-&gt;process(state,p_extension,strlen(p_extension));</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;        hasher-&gt;process(state,p_magic,strlen(p_magic));</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        hash = hasher-&gt;get_result(state);</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    }</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;</div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    p_out = p_origpath;</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;    p_out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a15259d65c9bd020eb630a1a6e71c3abd">truncate</a>(p_out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a7b547b32cf24ab23fc249bc56b21c316">scan_filename</a>());</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    p_out += <span class="stringliteral">&quot;temp-&quot;</span>;</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    p_out += <a class="code" href="../../d7/da5/classpfc_1_1format__hexdump.html">pfc::format_hexdump</a>(hash.<a class="code" href="../../da/dfb/structhasher__md5__result.html#af8bf1f4b7f0bf401251f304c4c896f06">m_data</a>,<span class="keyword">sizeof</span>(hash.<a class="code" href="../../da/dfb/structhasher__md5__result.html#af8bf1f4b7f0bf401251f304c4c896f06">m_data</a>),<span class="stringliteral">&quot;&quot;</span>);</div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    p_out += <span class="stringliteral">&quot;.&quot;</span>;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    p_out += p_extension;</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;}</div><div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;</div><div class="line"><a name="l00912"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a82985b6410177250f745d9fd3fb9b295">  912</a></span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> file::skip_seek(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_bytes,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> size = <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#aa6b03adbff3485bf5f5151178fa67bd7">get_size</a>(p_abort);</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <span class="keywordflow">if</span> (size != <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a8248180a5cfbcbc960de25522713db39">filesize_invalid</a>) {</div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> position = get_position(p_abort);</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> toskip = <a class="code" href="../../da/d46/namespacepfc.html#a6aee231a8e69ac6b24bcc53d9a6e077a">pfc::min_t</a>( p_bytes, size - position );</div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#a066f24f7277c206a771739ebb4b72944">seek</a>(position + toskip,p_abort);</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        <span class="keywordflow">return</span> toskip;</div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;        this-&gt;seek_ex( p_bytes, seek_from_current, p_abort );</div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <span class="keywordflow">return</span> p_bytes;</div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;    }</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;}</div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno"><a class="line" href="../../d9/db7/classfoobar2000__io_1_1file.html#a43f237b673be9b2b37c63a4ca760f2ba">  925</a></span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> file::skip(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> p_bytes,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    <span class="keywordflow">if</span> (p_bytes &gt; 1024 &amp;&amp; can_seek()) {</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> size = <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#aa6b03adbff3485bf5f5151178fa67bd7">get_size</a>(p_abort);</div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;        <span class="keywordflow">if</span> (size != <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a8248180a5cfbcbc960de25522713db39">filesize_invalid</a>) {</div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> position = get_position(p_abort);</div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            <span class="keyword">const</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> toskip = <a class="code" href="../../da/d46/namespacepfc.html#a6aee231a8e69ac6b24bcc53d9a6e077a">pfc::min_t</a>( p_bytes, size - position );</div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <a class="code" href="../../d4/d26/namespacefile__win32__helpers.html#a066f24f7277c206a771739ebb4b72944">seek</a>(position + toskip,p_abort);</div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            <span class="keywordflow">return</span> toskip;</div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        }</div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;    }</div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;    <span class="keywordflow">return</span> stream_reader::skip(p_bytes,p_abort);</div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;}</div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;</div><div class="line"><a name="l00938"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#aba20991bb27743929118ce4a2bb6bede">  938</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#aba20991bb27743929118ce4a2bb6bede">foobar2000_io::is_native_filesystem</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> * p_fspath ) {</div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#acc60e945185aeba1b787e33747ec1e73">_extract_native_path_ptr</a>( p_fspath );</div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;}</div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div><div class="line"><a name="l00942"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#acc60e945185aeba1b787e33747ec1e73">  942</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#acc60e945185aeba1b787e33747ec1e73">foobar2000_io::_extract_native_path_ptr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * &amp; p_fspath) {</div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> header[] = <span class="stringliteral">&quot;file://&quot;</span>; <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> headerLen = 7;</div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">if</span> (strncmp(p_fspath,header,headerLen) != 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;    p_fspath += headerLen;</div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;}</div><div class="line"><a name="l00948"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#aefb5dfd2df1388ae8c7bd83428e047c0">  948</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#aefb5dfd2df1388ae8c7bd83428e047c0">foobar2000_io::extract_native_path</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_fspath,<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; p_native) {</div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#acc60e945185aeba1b787e33747ec1e73">_extract_native_path_ptr</a>(p_fspath)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    p_native = p_fspath;</div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;}</div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;</div><div class="line"><a name="l00954"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#a347c3e93151cd14ff0b28cf008793d8f">  954</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a347c3e93151cd14ff0b28cf008793d8f">foobar2000_io::extract_native_path_ex</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * p_fspath, <a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; p_native) {</div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#acc60e945185aeba1b787e33747ec1e73">_extract_native_path_ptr</a>(p_fspath)) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keywordflow">if</span> (p_fspath[0] != <span class="charliteral">&#39;\\&#39;</span> || p_fspath[1] != <span class="charliteral">&#39;\\&#39;</span>) {</div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        p_native = <span class="stringliteral">&quot;\\\\?\\&quot;</span>;</div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        p_native += p_fspath;</div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        p_native = p_fspath;</div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    }</div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;}</div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div><div class="line"><a name="l00965"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#a210332b0dba5b57fec5406131c8939ad">  965</a></span>&#160;<a class="code" href="../../d5/dd2/classpfc_1_1string.html">pfc::string</a> stream_reader::read_string(<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <a class="code" href="../../d1/d8c/int__types_8h.html#ae3414e477e7bba6c40aac28eb0b5299c">t_uint32</a> len;</div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    read_lendian_t(len,p_abort);</div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="keywordflow">return</span> read_string_ex(len,p_abort);</div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;}</div><div class="line"><a name="l00970"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#a795a5894f58145ddd1fc27aa5cbbbe39">  970</a></span>&#160;<a class="code" href="../../d5/dd2/classpfc_1_1string.html">pfc::string</a> stream_reader::read_string_ex(<a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> p_len,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort) {</div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    <a class="code" href="../../d5/dd1/classpfc_1_1rcptr__t.html">pfc::rcptr_t&lt;pfc::string8&gt;</a> temp; temp.<a class="code" href="../../d5/dd1/classpfc_1_1rcptr__t.html#af3c38b884e7ebcc295576d828aea7b45">new_t</a>();</div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    read_object(temp-&gt;<a class="code" href="../../dc/d97/classpfc_1_1string8__t.html#ab49baa239a7bbf1d75b20e45206675d5">lock_buffer</a>(p_len),p_len,p_abort);</div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    temp-&gt;<a class="code" href="../../dc/d97/classpfc_1_1string8__t.html#a1e61902670139bcbefa4370ac1f2ddd0">unlock_buffer</a>();</div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../d5/dd2/classpfc_1_1string.html#ac5189d9a6f5f6f354ab327af93b4f380">pfc::string::t_data</a>(temp);</div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;}</div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;</div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;</div><div class="line"><a name="l00978"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#ac7a413e5f303f5411d7bdeb2afcd8b5a">  978</a></span>&#160;<span class="keywordtype">void</span> filesystem::remove_directory_content(<span class="keyword">const</span> <span class="keywordtype">char</span> * path, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; abort) {</div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keyword">class </span>myCallback : <span class="keyword">public</span> <a class="code" href="../../d0/de1/classfoobar2000__io_1_1directory__callback.html">directory_callback</a> {</div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;        <span class="keywordtype">bool</span> on_entry(<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html">filesystem</a> * p_owner,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_url,<span class="keywordtype">bool</span> p_is_subdirectory,<span class="keyword">const</span> <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> &amp; p_stats) {</div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            <span class="keywordflow">if</span> (p_is_subdirectory) p_owner-&gt;<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a8acba8dc32127e465c24459bc54ea0bf">list_directory</a>(p_url, *<span class="keyword">this</span>, p_abort);</div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            <span class="keywordflow">try</span> {</div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                p_owner-&gt;<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a977445969b0d39e7c2566ebfcfef1e59">remove</a>(p_url, p_abort);</div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            } <span class="keywordflow">catch</span>(exception_io_not_found) {}</div><div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        }</div><div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    };</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    myCallback cb;</div><div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    list_directory(path, cb, abort);</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;}</div><div class="line"><a name="l00992"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#ae11e7be0c0a66932746ff21af4204bd9">  992</a></span>&#160;<span class="keywordtype">void</span> filesystem::remove_object_recur(<span class="keyword">const</span> <span class="keywordtype">char</span> * path, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; abort) {</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;    <span class="keywordflow">try</span> {</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        remove_directory_content(path, abort);</div><div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;    } <span class="keywordflow">catch</span>(exception_io_not_found) {}</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;    <span class="keyword">remove</span>(path, abort);</div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;}</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;</div><div class="line"><a name="l00999"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#af34a76c763259da97a5d48e46e4a6f12">  999</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_remove_object_recur_timeout(<span class="keyword">const</span> <span class="keywordtype">char</span> * path, <span class="keywordtype">double</span> timeout, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; abort) {</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;    FB2K_RETRY_FILE_MOVE( g_remove_object_recur(path, abort), abort, timeout );</div><div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;}</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;</div><div class="line"><a name="l01003"></a><span class="lineno"><a class="line" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#ab1e40df66f3697808ff85bfdf9639843"> 1003</a></span>&#160;<span class="keywordtype">void</span> filesystem::g_remove_object_recur(<span class="keyword">const</span> <span class="keywordtype">char</span> * path, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; abort) {</div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    g_get_interface(path)-&gt;remove_object_recur(path, abort);</div><div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;}</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div><div class="line"><a name="l01007"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#a55f2feea62c7eb3b6f4fb2478ab6af15"> 1007</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a55f2feea62c7eb3b6f4fb2478ab6af15">foobar2000_io::purgeOldFiles</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * directory, <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#ac457a97cb865489e01ae724f1ca5f2d6">t_filetimestamp</a> period, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; abort) {</div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;</div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keyword">class </span>myCallback : <span class="keyword">public</span> <a class="code" href="../../d0/de1/classfoobar2000__io_1_1directory__callback.html">directory_callback</a> {</div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        myCallback(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#ac457a97cb865489e01ae724f1ca5f2d6">t_filetimestamp</a> period) : m_base(<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a7b3ab40fe689238e0503daa11b717d01">filetimestamp_from_system_timer</a>() - period) {}</div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="keywordtype">bool</span> on_entry(<a class="code" href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html">filesystem</a> * p_owner,<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; p_abort,<span class="keyword">const</span> <span class="keywordtype">char</span> * p_url,<span class="keywordtype">bool</span> p_is_subdirectory,<span class="keyword">const</span> <a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">t_filestats</a> &amp; p_stats) {</div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="keywordflow">if</span> (!p_is_subdirectory &amp;&amp; p_stats.<a class="code" href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html#af0883e72d1faa0818d0850c05b1c5b8e">m_timestamp</a> &lt; m_base) {</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                <span class="keywordflow">try</span> {</div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;                    filesystem::g_remove_timeout(p_url, 1, p_abort);</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                } <span class="keywordflow">catch</span>(exception_io_not_found) {}</div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            }</div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        }</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="keyword">private</span>:</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        <span class="keyword">const</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#ac457a97cb865489e01ae724f1ca5f2d6">t_filetimestamp</a> m_base;</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    };</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    myCallback cb(period);</div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;    filesystem::g_list_directory(directory, cb, abort);</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;}</div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;</div><div class="line"><a name="l01028"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#a64c56a06942e8ee643b277cd2c283046"> 1028</a></span>&#160;<span class="keywordtype">void</span> stream_reader::read_string_nullterm( <a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out, <a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; abort ) {</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    <span class="keyword">enum</span> { bufCount = 256 };</div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    <span class="keywordtype">char</span> buffer[bufCount];</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a377fd52e6bc50d1a561cbf5bb1aa6e83">reset</a>();</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    <span class="keywordtype">size_t</span> w = 0;</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    <span class="keywordflow">for</span>(;;) {</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <span class="keywordtype">char</span> &amp; c = buffer[w];</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        this-&gt;read_object( &amp;c, 1, abort );</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;        <span class="keywordflow">if</span> (c == 0) {</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a6a2bc34244698aa39f0c095e137ee316">add_string</a>( buffer, w ); <span class="keywordflow">break</span>;</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        }</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;        <span class="keywordflow">if</span> (++w == bufCount ) {</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;            out.<a class="code" href="../../d5/d74/classpfc_1_1string__base.html#a6a2bc34244698aa39f0c095e137ee316">add_string</a>( buffer, bufCount ); w = 0;</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        }</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;    }</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;}</div><div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;</div><div class="line"><a name="l01045"></a><span class="lineno"><a class="line" href="../../de/d55/classfoobar2000__io_1_1stream__reader.html#aa6488678970cc51c9a7913c22e080958"> 1045</a></span>&#160;<a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> stream_reader::skip_till_eof(<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">abort_callback</a> &amp; abort) {</div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> atOnce = 1024 * 1024;</div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> done = 0;</div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    <span class="keywordflow">for</span> (;; ) {</div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        abort.<a class="code" href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html#ac14be31076ddfe65fd41a9297c3dd10e">check</a>();</div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;        <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">t_filesize</a> did = this-&gt;skip(atOnce, abort);</div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        done += did;</div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <span class="keywordflow">if</span> (did != atOnce) <span class="keywordflow">break</span>;</div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    }</div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    <span class="keywordflow">return</span> done;</div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;}</div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;</div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;</div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;</div><div class="line"><a name="l01059"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#a7b6c2e19271fc7138821b6fd84e980e8"> 1059</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a7b6c2e19271fc7138821b6fd84e980e8">foobar2000_io::matchContentType</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * fullString, <span class="keyword">const</span> <span class="keywordtype">char</span> * ourType) {</div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> lim = <a class="code" href="../../da/d46/namespacepfc.html#a01d0f0d85bb0bd67a189a078d2220d56">pfc::string_find_first</a>(fullString, <span class="charliteral">&#39;;&#39;</span>);</div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <span class="keywordflow">if</span> (lim != ~0) {</div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;        <span class="keywordflow">while</span>(lim &gt; 0 &amp;&amp; fullString[lim-1] == <span class="charliteral">&#39; &#39;</span>) --lim;</div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    }</div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="../../da/d46/namespacepfc.html#a5c4b632ff5c0279b0ab79b2470bb8b01">pfc::stricmp_ascii_ex</a>(fullString,lim, ourType, ~0) == 0;</div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;}</div><div class="line"><a name="l01066"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#aa174b7b55a4b39ae2b6e83fc93d56c6c"> 1066</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#aa174b7b55a4b39ae2b6e83fc93d56c6c">foobar2000_io::matchProtocol</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> * fullString, <span class="keyword">const</span> <span class="keywordtype">char</span> * protocolName) {</div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keyword">const</span> <a class="code" href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a> len = strlen(protocolName);</div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="../../da/d46/namespacepfc.html#a5c4b632ff5c0279b0ab79b2470bb8b01">pfc::stricmp_ascii_ex</a>(fullString, len, protocolName, len) != 0) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;    <span class="keywordflow">return</span> fullString[len] == <span class="charliteral">&#39;:&#39;</span> &amp;&amp; fullString[len+1] == <span class="charliteral">&#39;/&#39;</span> &amp;&amp; fullString[len+2] == <span class="charliteral">&#39;/&#39;</span>;</div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;}</div><div class="line"><a name="l01071"></a><span class="lineno"><a class="line" href="../../dc/dea/namespacefoobar2000__io.html#a35fc25b2ef5ba3db2aaf5d50f55ed502"> 1071</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="../../dc/dea/namespacefoobar2000__io.html#a35fc25b2ef5ba3db2aaf5d50f55ed502">foobar2000_io::substituteProtocol</a>(<a class="code" href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a> &amp; out, <span class="keyword">const</span> <span class="keywordtype">char</span> * fullString, <span class="keyword">const</span> <span class="keywordtype">char</span> * protocolName) {</div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span> * base = strstr(fullString, <span class="stringliteral">&quot;://&quot;</span>);</div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    <span class="keywordflow">if</span> (base) {</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        out = protocolName; out &lt;&lt; base;</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    } <span class="keywordflow">else</span> {</div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        PFC_ASSERT(!<span class="stringliteral">&quot;Should not get here&quot;</span>);</div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;        out = fullString;</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    }</div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;}</div><div class="ttc" id="classpfc_1_1string__base_html"><div class="ttname"><a href="../../d5/d74/classpfc_1_1string__base.html">pfc::string_base</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00193">string_base.h:193</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1filesystem_html_a977445969b0d39e7c2566ebfcfef1e59"><div class="ttname"><a href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a977445969b0d39e7c2566ebfcfef1e59">foobar2000_io::filesystem::remove</a></div><div class="ttdeci">virtual void remove(const char *p_path, abort_callback &amp;p_abort)=0</div></div>
<div class="ttc" id="namespacetext__file__loader_html_a523f7796376195399b3791763806fc27"><div class="ttname"><a href="../../d3/d80/namespacetext__file__loader.html#a523f7796376195399b3791763806fc27">text_file_loader::read</a></div><div class="ttdeci">void read(const service_ptr_t&lt; file &gt; &amp;p_file, abort_callback &amp;p_abort, pfc::string_base &amp;p_out, bool &amp;is_utf8)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d32/text__file__loader_8cpp_source.html#l00029">text_file_loader.cpp:29</a></div></div>
<div class="ttc" id="namespacefile__win32__helpers_html_aa6b03adbff3485bf5f5151178fa67bd7"><div class="ttname"><a href="../../d4/d26/namespacefile__win32__helpers.html#aa6b03adbff3485bf5f5151178fa67bd7">file_win32_helpers::get_size</a></div><div class="ttdeci">t_filesize get_size(HANDLE p_handle)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da1/file__win32__wrapper_8cpp_source.html#l00005">file_win32_wrapper.cpp:5</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_a7b6c2e19271fc7138821b6fd84e980e8"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#a7b6c2e19271fc7138821b6fd84e980e8">foobar2000_io::matchContentType</a></div><div class="ttdeci">bool matchContentType(const char *fullString, const char *ourType)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l01059">filesystem.cpp:1059</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1file_html_a1722ee85dc0dc746b037107276a3d06c"><div class="ttname"><a href="../../d9/db7/classfoobar2000__io_1_1file.html#a1722ee85dc0dc746b037107276a3d06c">foobar2000_io::file::t_seek_mode</a></div><div class="ttdeci">t_seek_mode</div><div class="ttdoc">Seeking mode constants. Note: these are purposedly defined to same values as standard C SEEK_* consta...</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00212">filesystem.h:212</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_aff65056a9e08a68d3ddbc548b9f8044b"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#aff65056a9e08a68d3ddbc548b9f8044b">foobar2000_io::t_sfilesize</a></div><div class="ttdeci">t_int64 t_sfilesize</div><div class="ttdoc">Type used for file size related variables when a signed value is needed. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00010">filesystem.h:10</a></div></div>
<div class="ttc" id="classpfc_1_1array__t_html_acaadac76776907d2e4155872b6c609f4"><div class="ttname"><a href="../../d8/de4/classpfc_1_1array__t.html#acaadac76776907d2e4155872b6c609f4">pfc::array_t::get_ptr</a></div><div class="ttdeci">const t_item * get_ptr() const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d63/array_8h_source.html#l00213">array.h:213</a></div></div>
<div class="ttc" id="int__types_8h_html_a6db43f58b64d133266c806191b05213f"><div class="ttname"><a href="../../d1/d8c/int__types_8h.html#a6db43f58b64d133266c806191b05213f">t_uint8</a></div><div class="ttdeci">uint8_t t_uint8</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/int__types_8h_source.html#l00009">int_types.h:9</a></div></div>
<div class="ttc" id="structfoobar2000__io_1_1t__filestats_html_a3f420232c448e40510d4abe78152c9ee"><div class="ttname"><a href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html#a3f420232c448e40510d4abe78152c9ee">foobar2000_io::t_filestats::m_size</a></div><div class="ttdeci">t_filesize m_size</div><div class="ttdoc">Size of the file. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00071">filesystem.h:71</a></div></div>
<div class="ttc" id="classpfc_1_1rcptr__t_html_af3c38b884e7ebcc295576d828aea7b45"><div class="ttname"><a href="../../d5/dd1/classpfc_1_1rcptr__t.html#af3c38b884e7ebcc295576d828aea7b45">pfc::rcptr_t::new_t</a></div><div class="ttdeci">void new_t()</div><div class="ttdef"><b>Definition:</b> <a href="../../de/ddf/rcptr_8h_source.html#l00101">rcptr.h:101</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_a7b3ab40fe689238e0503daa11b717d01"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#a7b3ab40fe689238e0503daa11b717d01">foobar2000_io::filetimestamp_from_system_timer</a></div><div class="ttdeci">t_filetimestamp filetimestamp_from_system_timer()</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00684">filesystem.cpp:684</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1file_html"><div class="ttname"><a href="../../d9/db7/classfoobar2000__io_1_1file.html">foobar2000_io::file</a></div><div class="ttdoc">A class providing abstraction for an open file object, with reading/writing/seeking methods...</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00208">filesystem.h:208</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_af1a295298679aa0cddade9094259b2c9"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#af1a295298679aa0cddade9094259b2c9">foobar2000_io::win32_file_write_failure</a></div><div class="ttdeci">PFC_NORETURN void win32_file_write_failure(DWORD p_code, const char *path)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00765">filesystem.cpp:765</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1abort__callback_html"><div class="ttname"><a href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html">foobar2000_io::abort_callback</a></div><div class="ttdoc">This class is used to signal underlying worker code whether user has decided to abort a potentially t...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd3/abort__callback_8h_source.html#l00017">abort_callback.h:17</a></div></div>
<div class="ttc" id="namespacepfc_html_a6aee231a8e69ac6b24bcc53d9a6e077a"><div class="ttname"><a href="../../da/d46/namespacepfc.html#a6aee231a8e69ac6b24bcc53d9a6e077a">pfc::min_t</a></div><div class="ttdeci">T min_t(const T &amp;item1, const T &amp;item2)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d34/primitives_8h_source.html#l00556">primitives.h:556</a></div></div>
<div class="ttc" id="classpfc_1_1array__t_html"><div class="ttname"><a href="../../d8/de4/classpfc_1_1array__t.html">pfc::array_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d63/array_8h_source.html#l00006">array.h:6</a></div></div>
<div class="ttc" id="namespacefile__win32__helpers_html_a066f24f7277c206a771739ebb4b72944"><div class="ttname"><a href="../../d4/d26/namespacefile__win32__helpers.html#a066f24f7277c206a771739ebb4b72944">file_win32_helpers::seek</a></div><div class="ttdeci">void seek(HANDLE p_handle, t_sfilesize p_position, file::t_seek_mode p_mode)</div><div class="ttdef"><b>Definition:</b> <a href="../../d3/da1/file__win32__wrapper_8cpp_source.html#l00017">file_win32_wrapper.cpp:17</a></div></div>
<div class="ttc" id="shared_8h_html_a0c6fdbba169ad0b55f6bd3165f1a317a"><div class="ttname"><a href="../../da/db4/shared_8h.html#a0c6fdbba169ad0b55f6bd3165f1a317a">uGetFileAttributes</a></div><div class="ttdeci">DWORD SHARED_EXPORT uGetFileAttributes(const char *fn)</div></div>
<div class="ttc" id="classpfc_1_1string__base_html_a6a2bc34244698aa39f0c095e137ee316"><div class="ttname"><a href="../../d5/d74/classpfc_1_1string__base.html#a6a2bc34244698aa39f0c095e137ee316">pfc::string_base::add_string</a></div><div class="ttdeci">virtual void add_string(const char *p_string, t_size p_length=~0)=0</div></div>
<div class="ttc" id="int__types_8h_html_a9812fdc2df24f2c0a0db1b461b68a227"><div class="ttname"><a href="../../d1/d8c/int__types_8h.html#a9812fdc2df24f2c0a0db1b461b68a227">t_uint64</a></div><div class="ttdeci">uint64_t t_uint64</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/int__types_8h_source.html#l00003">int_types.h:3</a></div></div>
<div class="ttc" id="structhasher__md5__result_html_af8bf1f4b7f0bf401251f304c4c896f06"><div class="ttname"><a href="../../da/dfb/structhasher__md5__result.html#af8bf1f4b7f0bf401251f304c4c896f06">hasher_md5_result::m_data</a></div><div class="ttdeci">char m_data[16]</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db4/hasher__md5_8h_source.html#l00006">hasher_md5.h:6</a></div></div>
<div class="ttc" id="classservice__ptr__t_html_a461bb62075ae233d6c2e538f77b803d2"><div class="ttname"><a href="../../d4/d8a/classservice__ptr__t.html#a461bb62075ae233d6c2e538f77b803d2">service_ptr_t::get_ptr</a></div><div class="ttdeci">T * get_ptr() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d83/service_8h_source.html#l00117">service.h:117</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_ad1c9e41d00e6bc68e826b2120cc2b636"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#ad1c9e41d00e6bc68e826b2120cc2b636">foobar2000_io::exception_io_from_win32</a></div><div class="ttdeci">PFC_NORETURN void exception_io_from_win32(DWORD p_code)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00773">filesystem.cpp:773</a></div></div>
<div class="ttc" id="classservice__enum__t_html_a8a17594b8c79fff34fa2f950291e64a8"><div class="ttname"><a href="../../dc/d8f/classservice__enum__t.html#a8a17594b8c79fff34fa2f950291e64a8">service_enum_t::first</a></div><div class="ttdeci">bool first(service_ptr_t&lt; t_query &gt; &amp;p_out)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d83/service_8h_source.html#l00581">service.h:581</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_a347c3e93151cd14ff0b28cf008793d8f"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#a347c3e93151cd14ff0b28cf008793d8f">foobar2000_io::extract_native_path_ex</a></div><div class="ttdeci">bool extract_native_path_ex(const char *p_fspath, pfc::string_base &amp;p_native)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00954">filesystem.cpp:954</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_acc60e945185aeba1b787e33747ec1e73"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#acc60e945185aeba1b787e33747ec1e73">foobar2000_io::_extract_native_path_ptr</a></div><div class="ttdeci">bool _extract_native_path_ptr(const char *&amp;p_fspath)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00942">filesystem.cpp:942</a></div></div>
<div class="ttc" id="classpfc_1_1string8__t_html_a1e61902670139bcbefa4370ac1f2ddd0"><div class="ttname"><a href="../../dc/d97/classpfc_1_1string8__t.html#a1e61902670139bcbefa4370ac1f2ddd0">pfc::string8_t::unlock_buffer</a></div><div class="ttdeci">void unlock_buffer()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00417">string_base.h:417</a></div></div>
<div class="ttc" id="filesystem_8cpp_html_afb6ed478f8defbe5a59164a48fafbb32"><div class="ttname"><a href="../../d9/d8f/filesystem_8cpp.html#afb6ed478f8defbe5a59164a48fafbb32">path_unpack_string</a></div><div class="ttdeci">static int path_unpack_string(pfc::string_base &amp;out, const char *src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00226">filesystem.cpp:226</a></div></div>
<div class="ttc" id="classpfc_1_1string_html_ac5189d9a6f5f6f354ab327af93b4f380"><div class="ttname"><a href="../../d5/dd2/classpfc_1_1string.html#ac5189d9a6f5f6f354ab327af93b4f380">pfc::string::t_data</a></div><div class="ttdeci">rcptr_t&lt; string_base const  &gt; t_data</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d33/stringNew_8h_source.html#l00021">stringNew.h:21</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_a8248180a5cfbcbc960de25522713db39"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#a8248180a5cfbcbc960de25522713db39">foobar2000_io::filesize_invalid</a></div><div class="ttdeci">static const t_filesize filesize_invalid</div><div class="ttdoc">Invalid/unknown file size constant. Also see: t_filesize. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00016">filesystem.h:16</a></div></div>
<div class="ttc" id="namespacepfc_html_a5c4b632ff5c0279b0ab79b2470bb8b01"><div class="ttname"><a href="../../da/d46/namespacepfc.html#a5c4b632ff5c0279b0ab79b2470bb8b01">pfc::stricmp_ascii_ex</a></div><div class="ttdeci">int stricmp_ascii_ex(const char *const s1, t_size const len1, const char *const s2, t_size const len2)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/de2/string__base_8cpp_source.html#l00405">string_base.cpp:405</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1abort__callback_html_ac14be31076ddfe65fd41a9297c3dd10e"><div class="ttname"><a href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html#ac14be31076ddfe65fd41a9297c3dd10e">foobar2000_io::abort_callback::check</a></div><div class="ttdeci">void check() const </div><div class="ttdoc">Checks if user has requested the operation to be aborted, and throws exception_aborted if so...</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d92/abort__callback_8cpp_source.html#l00003">abort_callback.cpp:3</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_aba20991bb27743929118ce4a2bb6bede"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#aba20991bb27743929118ce4a2bb6bede">foobar2000_io::is_native_filesystem</a></div><div class="ttdeci">bool is_native_filesystem(const char *p_fspath)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00938">filesystem.cpp:938</a></div></div>
<div class="ttc" id="classpfc_1_1string8__t_html"><div class="ttname"><a href="../../dc/d97/classpfc_1_1string8__t.html">pfc::string8_t&lt; pfc::alloc_standard &gt;</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1filesystem_html_acbcbea8b03511fcfd8966c03da108050"><div class="ttname"><a href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#acbcbea8b03511fcfd8966c03da108050">foobar2000_io::filesystem::open</a></div><div class="ttdeci">virtual void open(service_ptr_t&lt; file &gt; &amp;p_out, const char *p_path, t_open_mode p_mode, abort_callback &amp;p_abort)=0</div></div>
<div class="ttc" id="classpfc_1_1string__base_html_a7b547b32cf24ab23fc249bc56b21c316"><div class="ttname"><a href="../../d5/d74/classpfc_1_1string__base.html#a7b547b32cf24ab23fc249bc56b21c316">pfc::string_base::scan_filename</a></div><div class="ttdeci">t_size scan_filename() const </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00235">string_base.h:235</a></div></div>
<div class="ttc" id="classstream__reader_html"><div class="ttname"><a href="../../d7/d0c/classstream__reader.html">stream_reader</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1directory__callback_html"><div class="ttname"><a href="../../d0/de1/classfoobar2000__io_1_1directory__callback.html">foobar2000_io::directory_callback</a></div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00373">filesystem.h:373</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1filesystem_html_aa773eda3e691cfe3baaaa71565c59dd2"><div class="ttname"><a href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#aa773eda3e691cfe3baaaa71565c59dd2">foobar2000_io::filesystem::t_open_mode</a></div><div class="ttdeci">t_open_mode</div><div class="ttdoc">Enumeration specifying how to open a file. See: filesystem::open(), filesystem::g_open(). </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00387">filesystem.h:387</a></div></div>
<div class="ttc" id="namespacepfc_html_a12079b17838e02b827dc3ff3e31911ff"><div class="ttname"><a href="../../da/d46/namespacepfc.html#a12079b17838e02b827dc3ff3e31911ff">pfc::dynamic_assert</a></div><div class="ttdeci">void dynamic_assert(bool p_condition, const char *p_msg)</div><div class="ttdef"><b>Definition:</b> <a href="../../de/d34/primitives_8h_source.html#l00239">primitives.h:239</a></div></div>
<div class="ttc" id="classservice__enum__t_html"><div class="ttname"><a href="../../dc/d8f/classservice__enum__t.html">service_enum_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d83/service_8h_source.html#l00573">service.h:573</a></div></div>
<div class="ttc" id="classpfc_1_1rcptr__t_html"><div class="ttname"><a href="../../d5/dd1/classpfc_1_1rcptr__t.html">pfc::rcptr_t&lt; pfc::string8 &gt;</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1archive_html"><div class="ttname"><a href="../../d7/d4f/classfoobar2000__io_1_1archive.html">foobar2000_io::archive</a></div><div class="ttdoc">Interface for archive reader services. When implementing, derive from archive_impl rather than from d...</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00519">filesystem.h:519</a></div></div>
<div class="ttc" id="classstream__writer_html"><div class="ttname"><a href="../../da/dd5/classstream__writer.html">stream_writer</a></div></div>
<div class="ttc" id="namespacepfc_html_aac5f485225d85be60883ad9a22415a38"><div class="ttname"><a href="../../da/d46/namespacepfc.html#aac5f485225d85be60883ad9a22415a38">pfc::strlen_max</a></div><div class="ttdeci">t_size strlen_max(const char *ptr, t_size max)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00091">string_base.h:91</a></div></div>
<div class="ttc" id="int__types_8h_html_ab26ea4b5e8504781be1c368c28967472"><div class="ttname"><a href="../../d1/d8c/int__types_8h.html#ab26ea4b5e8504781be1c368c28967472">t_size</a></div><div class="ttdeci">size_t t_size</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/int__types_8h_source.html#l00048">int_types.h:48</a></div></div>
<div class="ttc" id="namespacepfc_html_a59e4f7c779c41a94f3015c7f7b97bf95"><div class="ttname"><a href="../../da/d46/namespacepfc.html#a59e4f7c779c41a94f3015c7f7b97bf95">pfc::string_formatter</a></div><div class="ttdeci">string8_fastalloc string_formatter</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00615">string_base.h:615</a></div></div>
<div class="ttc" id="filesystem_8cpp_html_a4f34d56bac480070aa52f308ed977e74"><div class="ttname"><a href="../../d9/d8f/filesystem_8cpp.html#a4f34d56bac480070aa52f308ed977e74">unpack_prefix_len</a></div><div class="ttdeci">static const unsigned unpack_prefix_len</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00004">filesystem.cpp:4</a></div></div>
<div class="ttc" id="classpfc_1_1array__t_html_a7c13354feeefc4a46ea47df17bd8115f"><div class="ttname"><a href="../../d8/de4/classpfc_1_1array__t.html#a7c13354feeefc4a46ea47df17bd8115f">pfc::array_t::set_size</a></div><div class="ttdeci">void set_size(t_size p_size)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d63/array_8h_source.html#l00104">array.h:104</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_aa174b7b55a4b39ae2b6e83fc93d56c6c"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#aa174b7b55a4b39ae2b6e83fc93d56c6c">foobar2000_io::matchProtocol</a></div><div class="ttdeci">bool matchProtocol(const char *fullString, const char *protocolName)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l01066">filesystem.cpp:1066</a></div></div>
<div class="ttc" id="classservice__ptr__t_html_af5f325feac35d1d9f979f2ea71278190"><div class="ttname"><a href="../../d4/d8a/classservice__ptr__t.html#af5f325feac35d1d9f979f2ea71278190">service_ptr_t::release</a></div><div class="ttdeci">void release()</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d83/service_8h_source.html#l00109">service.h:109</a></div></div>
<div class="ttc" id="classpfc_1_1format__hexdump_html"><div class="ttname"><a href="../../d7/da5/classpfc_1_1format__hexdump.html">pfc::format_hexdump</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00618">string_base.h:618</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1abort__callback__dummy_html"><div class="ttname"><a href="../../d4/d68/classfoobar2000__io_1_1abort__callback__dummy.html">foobar2000_io::abort_callback_dummy</a></div><div class="ttdoc">Dummy abort_callback that never gets aborted.  Slightly more efficient than the regular one especiall...</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd3/abort__callback_8h_source.html#l00077">abort_callback.h:77</a></div></div>
<div class="ttc" id="namespacepfc_html_afe4f860f8c74038d00eb4f46e1f3753d"><div class="ttname"><a href="../../da/d46/namespacepfc.html#afe4f860f8c74038d00eb4f46e1f3753d">pfc::scan_filename</a></div><div class="ttdeci">t_size scan_filename(const char *ptr)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/de2/string__base_8cpp_source.html#l00693">string_base.cpp:693</a></div></div>
<div class="ttc" id="structfoobar2000__io_1_1t__filestats_html_af0883e72d1faa0818d0850c05b1c5b8e"><div class="ttname"><a href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html#af0883e72d1faa0818d0850c05b1c5b8e">foobar2000_io::t_filestats::m_timestamp</a></div><div class="ttdeci">t_filetimestamp m_timestamp</div><div class="ttdoc">Time of last file modification. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00073">filesystem.h:73</a></div></div>
<div class="ttc" id="classpfc_1_1string__base_html_af5066868b1828de502dca57545c5ac7e"><div class="ttname"><a href="../../d5/d74/classpfc_1_1string__base.html#af5066868b1828de502dca57545c5ac7e">pfc::string_base::set_string</a></div><div class="ttdeci">virtual void set_string(const char *p_string, t_size p_length=~0)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00198">string_base.h:198</a></div></div>
<div class="ttc" id="filesystem_8cpp_html_ae006d9e1193225b2370859c90f0053c8"><div class="ttname"><a href="../../d9/d8f/filesystem_8cpp.html#ae006d9e1193225b2370859c90f0053c8">makeBuffer</a></div><div class="ttdeci">static void makeBuffer(pfc::array_t&lt; uint8_t &gt; &amp;buffer, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00040">filesystem.cpp:40</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_aefb5dfd2df1388ae8c7bd83428e047c0"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#aefb5dfd2df1388ae8c7bd83428e047c0">foobar2000_io::extract_native_path</a></div><div class="ttdeci">bool extract_native_path(const char *p_fspath, pfc::string_base &amp;p_native)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00948">filesystem.cpp:948</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_a55f2feea62c7eb3b6f4fb2478ab6af15"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#a55f2feea62c7eb3b6f4fb2478ab6af15">foobar2000_io::purgeOldFiles</a></div><div class="ttdeci">void purgeOldFiles(const char *directory, t_filetimestamp period, abort_callback &amp;abort)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l01007">filesystem.cpp:1007</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_afb56af03bc9888fc80803cf42078654b"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#afb56af03bc9888fc80803cf42078654b">foobar2000_io::generate_temp_location_for_file</a></div><div class="ttdeci">void generate_temp_location_for_file(pfc::string_base &amp;p_out, const char *p_origpath, const char *p_extension, const char *p_magic)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00892">filesystem.cpp:892</a></div></div>
<div class="ttc" id="namespacecue__parser_html_af85dc495fbaefec33124ed01c4c7541f"><div class="ttname"><a href="../../dd/d06/namespacecue__parser.html#af85dc495fbaefec33124ed01c4c7541f">cue_parser::PFC_DECLARE_EXCEPTION</a></div><div class="ttdeci">PFC_DECLARE_EXCEPTION(exception_bad_cuesheet, exception_io_data,&quot;Invalid cuesheet&quot;)</div></div>
<div class="ttc" id="namespacefoobar2000__io_html_a35fc25b2ef5ba3db2aaf5d50f55ed502"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#a35fc25b2ef5ba3db2aaf5d50f55ed502">foobar2000_io::substituteProtocol</a></div><div class="ttdeci">void substituteProtocol(pfc::string_base &amp;out, const char *fullString, const char *protocolName)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l01071">filesystem.cpp:1071</a></div></div>
<div class="ttc" id="foobar2000_8h_html"><div class="ttname"><a href="../../dd/d82/foobar2000_8h.html">foobar2000.h</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1filesystem_html"><div class="ttname"><a href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html">foobar2000_io::filesystem</a></div><div class="ttdoc">Entrypoint service for all filesystem operations. Implementation: standard implementations for local ...</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00383">filesystem.h:383</a></div></div>
<div class="ttc" id="classunpacker_html_abd7522209802f1c1745eef5ab40da174"><div class="ttname"><a href="../../de/dfe/classunpacker.html#abd7522209802f1c1745eef5ab40da174">unpacker::g_open</a></div><div class="ttdeci">static void g_open(service_ptr_t&lt; file &gt; &amp;p_out, const service_ptr_t&lt; file &gt; &amp;p_source, abort_callback &amp;p_abort)</div><div class="ttdoc">Static helper querying existing unpacker implementations until one that successfully opens specified ...</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00006">filesystem.cpp:6</a></div></div>
<div class="ttc" id="classpfc_1_1string8__t_html_ab49baa239a7bbf1d75b20e45206675d5"><div class="ttname"><a href="../../dc/d97/classpfc_1_1string8__t.html#ab49baa239a7bbf1d75b20e45206675d5">pfc::string8_t::lock_buffer</a></div><div class="ttdeci">char * lock_buffer(t_size n)</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00409">string_base.h:409</a></div></div>
<div class="ttc" id="classabort__callback_html"><div class="ttname"><a href="../../d8/d6a/classabort__callback.html">abort_callback</a></div></div>
<div class="ttc" id="classpfc_1_1string__receiver_html_afb746d606ff9a54ab8fb2d978644ad49"><div class="ttname"><a href="../../d0/d89/classpfc_1_1string__receiver.html#afb746d606ff9a54ab8fb2d978644ad49">pfc::string_receiver::add_char</a></div><div class="ttdeci">void add_char(t_uint32 c)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/de2/string__base_8cpp_source.html#l00005">string_base.cpp:5</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_ac457a97cb865489e01ae724f1ca5f2d6"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#ac457a97cb865489e01ae724f1ca5f2d6">foobar2000_io::t_filetimestamp</a></div><div class="ttdeci">t_uint64 t_filetimestamp</div><div class="ttdoc">Type used for file timestamp related variables. 64-bit value representing the number of 100-nanosecon...</div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00012">filesystem.h:12</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1filesystem_html_a8acba8dc32127e465c24459bc54ea0bf"><div class="ttname"><a href="../../d2/dbf/classfoobar2000__io_1_1filesystem.html#a8acba8dc32127e465c24459bc54ea0bf">foobar2000_io::filesystem::list_directory</a></div><div class="ttdeci">virtual void list_directory(const char *p_path, directory_callback &amp;p_out, abort_callback &amp;p_abort)=0</div></div>
<div class="ttc" id="classpfc_1_1string__buffer_html_a9c7fdc50ff1c9f3c1940bce45dee29b5"><div class="ttname"><a href="../../dc/d22/classpfc_1_1string__buffer.html#a9c7fdc50ff1c9f3c1940bce45dee29b5">pfc::string_buffer::get_ptr</a></div><div class="ttdeci">char * get_ptr()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00462">string_base.h:462</a></div></div>
<div class="ttc" id="namespacepfc_html_a58b2a5281932d39848679464328efdc5"><div class="ttname"><a href="../../da/d46/namespacepfc.html#a58b2a5281932d39848679464328efdc5">pfc::fileTimeNow</a></div><div class="ttdeci">uint64_t fileTimeNow()</div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db4/timers_8cpp_source.html#l00066">timers.cpp:66</a></div></div>
<div class="ttc" id="namespacefoobar2000__io_html_a73f7311454a617d1b8d6b97f0613435d"><div class="ttname"><a href="../../dc/dea/namespacefoobar2000__io.html#a73f7311454a617d1b8d6b97f0613435d">foobar2000_io::t_filesize</a></div><div class="ttdeci">t_uint64 t_filesize</div><div class="ttdoc">Type used for file size related variables. </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00008">filesystem.h:8</a></div></div>
<div class="ttc" id="classpfc_1_1string__base_html_a377fd52e6bc50d1a561cbf5bb1aa6e83"><div class="ttname"><a href="../../d5/d74/classpfc_1_1string__base.html#a377fd52e6bc50d1a561cbf5bb1aa6e83">pfc::string_base::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00211">string_base.h:211</a></div></div>
<div class="ttc" id="classfoobar2000__io_1_1abort__callback_html_a08c5b76b05e08bd6535b42e1eb8e420b"><div class="ttname"><a href="../../d4/d6b/classfoobar2000__io_1_1abort__callback.html#a08c5b76b05e08bd6535b42e1eb8e420b">foobar2000_io::abort_callback::check_e</a></div><div class="ttdeci">void check_e() const </div><div class="ttdoc">For compatibility with old code. Do not call. </div><div class="ttdef"><b>Definition:</b> <a href="../../d5/dd3/abort__callback_8h_source.html#l00035">abort_callback.h:35</a></div></div>
<div class="ttc" id="classservice__ptr__t_html"><div class="ttname"><a href="../../d4/d8a/classservice__ptr__t.html">service_ptr_t&lt; file &gt;</a></div></div>
<div class="ttc" id="classpfc_1_1string_html"><div class="ttname"><a href="../../d5/dd2/classpfc_1_1string.html">pfc::string</a></div><div class="ttdoc">New EXPERIMENTAL string class, allowing efficient copies and returning from functions.  Does not implement the string_base interface so you still need string8 in many cases.  Safe to pass between DLLs, but since a reference is used, objects possibly created by other DLLs must be released before owning DLLs are unloaded. </div><div class="ttdef"><b>Definition:</b> <a href="../../d7/d33/stringNew_8h_source.html#l00019">stringNew.h:19</a></div></div>
<div class="ttc" id="classpfc_1_1array__t_html_a1d4449e12b37201ba1a93752ab8b8c5e"><div class="ttname"><a href="../../d8/de4/classpfc_1_1array__t.html#a1d4449e12b37201ba1a93752ab8b8c5e">pfc::array_t::set_size_discard</a></div><div class="ttdeci">void set_size_discard(t_size p_size)</div><div class="ttdef"><b>Definition:</b> <a href="../../db/d63/array_8h_source.html#l00128">array.h:128</a></div></div>
<div class="ttc" id="structfoobar2000__io_1_1t__filestats_html"><div class="ttname"><a href="../../d8/d39/structfoobar2000__io_1_1t__filestats.html">foobar2000_io::t_filestats</a></div><div class="ttdoc">Stores file stats (size and timestamp). </div><div class="ttdef"><b>Definition:</b> <a href="../../dd/dd8/filesystem_8h_source.html#l00069">filesystem.h:69</a></div></div>
<div class="ttc" id="namespacepfc_html_a01d0f0d85bb0bd67a189a078d2220d56"><div class="ttname"><a href="../../da/d46/namespacepfc.html#a01d0f0d85bb0bd67a189a078d2220d56">pfc::string_find_first</a></div><div class="ttdeci">t_size string_find_first(const char *p_string, char p_tofind, t_size p_start)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/de2/string__base_8cpp_source.html#l00706">string_base.cpp:706</a></div></div>
<div class="ttc" id="hasher__md5_8h_html_d5/d6f/structhasher__md5__state"><div class="ttname"><a href="../../d2/db4/hasher__md5_8h.html#d5/d6f/structhasher__md5__state">hasher_md5_state</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db4/hasher__md5_8h_source.html#l00001">hasher_md5.h:1</a></div></div>
<div class="ttc" id="classstatic__api__ptr__t_html"><div class="ttname"><a href="../../d2/da4/classstatic__api__ptr__t.html">static_api_ptr_t&lt; hasher_md5 &gt;</a></div></div>
<div class="ttc" id="filesystem_8cpp_html_aaf682e7ffda5d7c843ba2f46fe8270f0"><div class="ttname"><a href="../../d9/d8f/filesystem_8cpp.html#aaf682e7ffda5d7c843ba2f46fe8270f0">unpack_prefix</a></div><div class="ttdeci">static const char unpack_prefix[]</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00003">filesystem.cpp:3</a></div></div>
<div class="ttc" id="filesystem_8cpp_html_a98bb9acbb9e1b019198fc0b25ae70cd6"><div class="ttname"><a href="../../d9/d8f/filesystem_8cpp.html#a98bb9acbb9e1b019198fc0b25ae70cd6">path_pack_string</a></div><div class="ttdeci">static void path_pack_string(pfc::string_base &amp;out, const char *src)</div><div class="ttdef"><b>Definition:</b> <a href="../../d9/d8f/filesystem_8cpp_source.html#l00217">filesystem.cpp:217</a></div></div>
<div class="ttc" id="classpfc_1_1stringcvt_1_1string__wide__from__utf8__t_html"><div class="ttname"><a href="../../d9/d66/classpfc_1_1stringcvt_1_1string__wide__from__utf8__t.html">pfc::stringcvt::string_wide_from_utf8_t</a></div><div class="ttdef"><b>Definition:</b> <a href="../../db/d9f/string__conv_8h_source.html#l00116">string_conv.h:116</a></div></div>
<div class="ttc" id="classpfc_1_1string__base_html_a15259d65c9bd020eb630a1a6e71c3abd"><div class="ttname"><a href="../../d5/d74/classpfc_1_1string__base.html#a15259d65c9bd020eb630a1a6e71c3abd">pfc::string_base::truncate</a></div><div class="ttdeci">virtual void truncate(t_size len)=0</div></div>
<div class="ttc" id="classpfc_1_1array__t_html_a0231c35bc24e3610cb6e32bcaad30295"><div class="ttname"><a href="../../d8/de4/classpfc_1_1array__t.html#a0231c35bc24e3610cb6e32bcaad30295">pfc::array_t::get_size</a></div><div class="ttdeci">t_size get_size() const </div><div class="ttdef"><b>Definition:</b> <a href="../../db/d63/array_8h_source.html#l00130">array.h:130</a></div></div>
<div class="ttc" id="classservice__enum__t_html_aa7bc4a60879309afea538110b61a7512"><div class="ttname"><a href="../../dc/d8f/classservice__enum__t.html#aa7bc4a60879309afea538110b61a7512">service_enum_t::next</a></div><div class="ttdeci">bool next(service_ptr_t&lt; t_query &gt; &amp;p_out)</div><div class="ttdef"><b>Definition:</b> <a href="../../d5/d83/service_8h_source.html#l00587">service.h:587</a></div></div>
<div class="ttc" id="classpfc_1_1string__buffer_html"><div class="ttname"><a href="../../dc/d22/classpfc_1_1string__buffer.html">pfc::string_buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00455">string_base.h:455</a></div></div>
<div class="ttc" id="namespacepfc_html_a1832fb4e2e570eb33039ca084be3154d"><div class="ttname"><a href="../../da/d46/namespacepfc.html#a1832fb4e2e570eb33039ca084be3154d">pfc::string8_fastalloc</a></div><div class="ttdeci">string8_t&lt; pfc::alloc_fast_aggressive &gt; string8_fastalloc</div><div class="ttdef"><b>Definition:</b> <a href="../../d7/dee/string__base_8h_source.html#l00436">string_base.h:436</a></div></div>
<div class="ttc" id="foo__input__validator_2readme_8txt_html_a8de871b7776afe2f0ed67c8877386972"><div class="ttname"><a href="../../d8/da1/foo__input__validator_2readme_8txt.html#a8de871b7776afe2f0ed67c8877386972">file</a></div><div class="ttdeci">Decoder Validator v1 readme Usage Select a single file handled by the decoder you want to select Utils Decoder Utils Tag Writer Validator or Utils Fuzzer from the context menu with randomly generated info In case of the file will likely be permanently damaged or left with nonsense in its tags What Decoder Validator does Decoder Validator runs a series of automated decoding tests on the specified file</div><div class="ttdef"><b>Definition:</b> <a href="../../d8/da1/foo__input__validator_2readme_8txt_source.html#l00008">readme.txt:8</a></div></div>
<div class="ttc" id="int__types_8h_html_ae3414e477e7bba6c40aac28eb0b5299c"><div class="ttname"><a href="../../d1/d8c/int__types_8h.html#ae3414e477e7bba6c40aac28eb0b5299c">t_uint32</a></div><div class="ttdeci">uint32_t t_uint32</div><div class="ttdef"><b>Definition:</b> <a href="../../d1/d8c/int__types_8h_source.html#l00005">int_types.h:5</a></div></div>
<div class="ttc" id="structhasher__md5__result_html"><div class="ttname"><a href="../../da/dfb/structhasher__md5__result.html">hasher_md5_result</a></div><div class="ttdef"><b>Definition:</b> <a href="../../d2/db4/hasher__md5_8h_source.html#l00005">hasher_md5.h:5</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
